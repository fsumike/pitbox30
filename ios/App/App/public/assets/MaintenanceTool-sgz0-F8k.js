import{j as e,ao as s,B as a,r as t,L as l,c as r,O as i,W as c,aP as n,u as d,Y as o,a as m,e as x,m as h,V as g,aQ as p,a0 as j,f as u,X as b}from"./ui-v2ReSvUE.js";import{r as y}from"./react-YWE4JMTy.js";import{u as N,v as f}from"./index-Cgc97SP_.js";import{u as v}from"./useMaintenanceChecklists-DpInN0cF.js";import"./router-BNBI7_bc.js";import"./supabase-Du4GZSDg.js";function k({isOpen:s,onClose:a,onAdd:t,category:l}){const[r,i]=y.useState("");return s?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:e.jsx(h.div,{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-md",initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Add ",{post_race:"Post-Race",shop:"Shop/Garage",pre_race:"Pre-Race"}[l]," Item"]}),e.jsx("button",{onClick:a,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full",children:e.jsx(b,{className:"w-5 h-5"})})]}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),r.trim()&&(t(l,r.trim()),i(""),a())},className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"itemText",className:"block text-sm font-medium mb-2",children:"Checklist Item"}),e.jsx("textarea",{id:"itemText",value:r,onChange:e=>i(e.target.value),className:"w-full p-3 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800",rows:3,placeholder:"Enter the maintenance task...",required:!0})]}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{type:"button",onClick:a,className:"px-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700",children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-brand-gold text-white rounded-lg hover:bg-brand-gold-dark",children:"Add Item"})]})]})]})})}):null}function w(){var b;const{user:w}=N(),{getChecklist:C,saveChecklist:S,getDefaultChecklist:T,restoreDefaultChecklist:P,loading:R,error:_}=v(),[A,D]=y.useState(null),[F,I]=y.useState(null),[M,V]=y.useState(["post_race","shop","pre_race"]),[O,$]=y.useState(!1),[E,z]=y.useState("post_race"),[G,L]=y.useState(!1),[U,Y]=y.useState(!1),q=f.Vehicles.flatMap(e=>e.subcategories.map(s=>({name:s.name,path:s.path.replace("/",""),category:e.name})));y.useEffect(()=>{A&&B()},[A]);const B=async()=>{if(A)try{let e=await C(A);e||(e=await T(A)),I(e)}catch(e){}},K={post_race:{title:"Post-Race Tasks",description:"Immediate tasks after coming off the track",icon:d,color:"text-red-500",bgColor:"bg-red-500/10"},shop:{title:"Shop/Garage Tasks",description:"Detailed maintenance when back at the shop",icon:s,color:"text-blue-500",bgColor:"bg-blue-500/10"},pre_race:{title:"Pre-Race Preparation",description:"Everything needed before the next race",icon:n,color:"text-green-500",bgColor:"bg-green-500/10"}};return w?e.jsxs("div",{className:"space-y-6",children:[_&&e.jsxs("div",{className:"p-3 rounded-lg bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 flex items-center gap-2",children:[e.jsx(a,{className:"w-5 h-5 flex-shrink-0"}),_]}),A?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[null==(b=q.find(e=>e.path===A))?void 0:b.name," Maintenance"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Complete maintenance checklist"})]}),e.jsx("button",{onClick:()=>D(null),className:"btn-secondary text-sm",children:"Change Vehicle"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("button",{onClick:async()=>{if(A&&F){L(!0);try{await S(A,F)&&(Y(!0),setTimeout(()=>Y(!1),3e3))}catch(e){}finally{L(!1)}}},disabled:G||!F,className:"btn-primary flex items-center gap-2",children:G?e.jsxs(e.Fragment,{children:[e.jsx(l,{className:"w-5 h-5 animate-spin"}),"Saving..."]}):U?e.jsxs(e.Fragment,{children:[e.jsx(r,{className:"w-5 h-5"}),"Saved!"]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{className:"w-5 h-5"}),"Save Progress"]})}),e.jsxs("button",{onClick:async()=>{if(A)try{const e=await P(A);e&&I(e)}catch(e){}},className:"btn-secondary flex items-center gap-2",children:[e.jsx(c,{className:"w-5 h-5"}),"Restore Default"]})]})]}),R?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(l,{className:"w-8 h-8 animate-spin text-brand-gold"})}):F?e.jsx("div",{className:"space-y-6",children:Object.entries(K).map(([s,a])=>{const t=s,l=F[t]||[],r=(e=>{if(0===e.length)return 0;const s=e.filter(e=>e.completed).length;return Math.round(s/e.length*100)})(l),i=M.includes(t),c=a.icon;return e.jsxs("div",{className:`glass-panel overflow-hidden ${a.bgColor}`,children:[e.jsxs("button",{onClick:()=>{return e=t,void V(s=>s.includes(e)?s.filter(s=>s!==e):[...s,e]);var e},className:"w-full p-6 text-left hover:bg-white/5 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(c,{className:`w-8 h-8 ${a.color}`}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold",children:a.title}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:a.description})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-2xl font-bold ${a.color}`,children:[r,"%"]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[l.filter(e=>e.completed).length," of ",l.length]})]}),i?e.jsx(o,{className:"w-6 h-6"}):e.jsx(m,{className:"w-6 h-6"})]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2 mt-4",children:e.jsx("div",{className:"h-2 rounded-full transition-all duration-500 "+(100===r?"bg-green-500":r>=50?"bg-yellow-500":"bg-red-500"),style:{width:`${r}%`}})})]}),e.jsx(x,{children:i&&e.jsx(h.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"overflow-hidden",children:e.jsxs("div",{className:"p-6 pt-0",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold",children:"Tasks"}),e.jsxs("button",{onClick:()=>{z(t),$(!0)},className:"btn-secondary flex items-center gap-2 text-sm",children:[e.jsx(g,{className:"w-4 h-4"}),"Add Task"]})]}),e.jsxs("div",{className:"space-y-3",children:[l.map(s=>e.jsxs(h.div,{className:"flex items-start gap-3 p-3 rounded-lg bg-white/50 dark:bg-gray-800/50 hover:bg-white/70 dark:hover:bg-gray-800/70 transition-colors group",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},children:[e.jsx("button",{onClick:()=>((e,s)=>{F&&I(a=>a?{...a,[e]:a[e].map(e=>e.id===s?{...e,completed:!e.completed}:e)}:a)})(t,s.id),className:"mt-1 flex-shrink-0",children:s.completed?e.jsx(n,{className:"w-5 h-5 text-green-500"}):e.jsx(p,{className:"w-5 h-5 text-gray-400"})}),e.jsx("span",{className:"flex-1 "+(s.completed?"line-through text-gray-500 dark:text-gray-400":""),children:s.text}),e.jsx("button",{onClick:()=>((e,s)=>{F&&I(a=>a?{...a,[e]:a[e].filter(e=>e.id!==s)}:a)})(t,s.id),className:"opacity-0 group-hover:opacity-100 p-1 text-red-500 hover:bg-red-100 dark:hover:bg-red-900/30 rounded transition-all",title:"Remove item",children:e.jsx(j,{className:"w-4 h-4"})})]},s.id)),0===l.length&&e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[e.jsx(u,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No tasks in this category yet."}),e.jsxs("button",{onClick:()=>{z(t),$(!0)},className:"btn-primary mt-4 flex items-center gap-2 mx-auto",children:[e.jsx(g,{className:"w-4 h-4"}),"Add First Task"]})]})]})]})})})]},t)})}):e.jsxs("div",{className:"glass-panel p-12 text-center",children:[e.jsx(u,{className:"w-16 h-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Loading Checklist..."})]})]}):e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:"Select Your Racing Vehicle"}),f.Vehicles.map(s=>e.jsxs("div",{className:"mb-8",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4 text-brand-gold",children:s.name}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:s.subcategories.map(s=>e.jsx("button",{onClick:()=>{return e=s.path.replace("/",""),D(e),void I(null);var e},className:"glass-panel p-4 text-left hover:bg-brand-gold/5 transition-colors group",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(t,{className:"w-6 h-6 text-brand-gold"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Maintenance checklist"})]})]})},s.path))})]},s.name))]})}),e.jsx(k,{isOpen:O,onClose:()=>$(!1),onAdd:(e,s)=>{if(!F)return;const a={id:crypto.randomUUID(),text:s,completed:!1,category:e};I(s=>s?{...s,[e]:[...s[e],a]}:s)},category:E})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(s,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Sign in to access maintenance checklists"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Keep your race car in top condition with customized checklists"})]})}export{w as default};

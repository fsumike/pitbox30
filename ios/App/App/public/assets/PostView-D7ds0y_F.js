import{j as e,L as t,a8 as s,F as a,aJ as r,n,ai as l,aK as i,B as o,ac as c,m as d,U as m,p as u,M as h,au as p,E as x,ah as g,af as f,H as b,a4 as v,X as j,S as y,aL as w}from"./ui-v2ReSvUE.js";import{r as N,b as k}from"./react-YWE4JMTy.js";import{m as _,n as C,o as S,u as $,s as M}from"./index-Cgc97SP_.js";import{R as P,G as F,E as I,C as z}from"./GifPicker-BGwibceY.js";import{L as E}from"./maps-jNuXSUeC.js";import{d as R,u as T}from"./router-BNBI7_bc.js";import{f as D}from"./format-DltpeZFQ.js";import{f as O}from"./formatDistanceToNow-C1OK0Che.js";import"./supabase-Du4GZSDg.js";import"./useLocation-D3TBQNJQ.js";delete E.Icon.Default.prototype._getIconUrl,E.Icon.Default.mergeOptions({iconRetinaUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon-2x.png",iconUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-icon.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/images/marker-shadow.png"});const U=(e=!1)=>E.divIcon({className:"custom-div-icon",html:`\n      <div class="marker-pin ${e?"selected":""}">\n        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="marker-icon">\n          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>\n          <circle cx="12" cy="10" r="3"></circle>\n        </svg>\n      </div>\n    `,iconSize:[30,42],iconAnchor:[15,42],popupAnchor:[0,-42]});function B({center:t,zoom:s=13,markers:a=[],height:r="400px",className:n="",onMapClick:l,onMarkerClick:i}){const o=N.useRef(null),c=N.useRef(null),d=N.useRef([]);return N.useEffect(()=>{if(o.current){c.current&&(c.current.remove(),c.current=null,d.current=[]);try{const e=E.map(o.current,{zoomControl:!0,attributionControl:!0,scrollWheelZoom:!0,dragging:!E.Browser.mobile,tap:!E.Browser.mobile}).setView(t,s);if(c.current=e,E.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19}).addTo(e),a.length>0)a.forEach(t=>{const s=U(t.isSelected),a=E.marker(t.position,{icon:s}).addTo(e);t.popup&&(a.bindPopup(t.popup),t.isSelected&&a.openPopup()),i&&a.on("click",()=>i(t.position[0],t.position[1])),d.current.push(a)});else{const s=E.marker(t,{icon:U()}).addTo(e);i&&s.on("click",()=>i(t[0],t[1])),d.current.push(s)}l&&e.on("click",e=>{l(e.latlng.lat,e.latlng.lng)});const r=document.createElement("style");r.textContent="\n        .marker-pin {\n          width: 30px;\n          height: 42px;\n          display: flex;\n          justify-content: center;\n          align-items: center;\n          color: #D4AF37;\n        }\n        .marker-pin.selected {\n          color: #ff3e00;\n          transform: scale(1.2);\n        }\n        .marker-icon {\n          width: 30px;\n          height: 42px;\n        }\n      ",document.head.appendChild(r),E.Browser.touch&&E.DomEvent.disableClickPropagation(o.current)}catch(e){}return()=>{c.current&&(c.current.remove(),c.current=null),d.current=[]}}},[]),N.useEffect(()=>{if(c.current)try{c.current.setView(t,s),d.current.forEach(e=>{e.remove()}),d.current=[],a.length>0&&a.forEach(e=>{const t=U(e.isSelected),s=E.marker(e.position,{icon:t}).addTo(c.current);e.popup&&(s.bindPopup(e.popup),e.isSelected&&s.openPopup()),i&&s.on("click",()=>i(e.position[0],e.position[1])),d.current.push(s)})}catch(e){}},[t,s,a,i]),e.jsx("div",{ref:o,className:`rounded-lg overflow-hidden ${n}`,style:{height:r,width:"100%"}})}function G({center:s,zoom:a=13,markers:r=[],height:n="400px",className:l="",onMapClick:i,onMarkerClick:o,showDirections:c=!1,destination:d}){const m=N.useRef(null),[u,h]=N.useState(!0),[p,x]=N.useState(null);N.useEffect(()=>{(async()=>{try{_()?await g():C()?await f():x("Native maps only available on iOS and Android. Use MapComponent for web."),h(!1)}catch(e){x("Failed to initialize map. Please try again."),h(!1)}})()},[s,r,c,d]);const g=async()=>{var e,t;const n={center:s,zoom:a,markers:r,showDirections:c,destination:d};if(!(null==(t=null==(e=window.webkit)?void 0:e.messageHandlers)?void 0:t.mapHandler))throw new Error("iOS map handler not available");window.webkit.messageHandlers.mapHandler.postMessage({action:"initialize",config:n})},f=async()=>{var e;const t={center:s,zoom:a,markers:r,showDirections:c,destination:d};if(!(null==(e=window.Android)?void 0:e.initializeMap))throw new Error("Android map interface not available");window.Android.initializeMap(JSON.stringify(t))};return u?e.jsx("div",{className:`rounded-lg overflow-hidden relative ${l} flex items-center justify-center bg-gray-100 dark:bg-gray-800`,style:{height:n},children:e.jsx(t,{className:"w-8 h-8 animate-spin text-brand-gold"})}):p?e.jsx("div",{className:`rounded-lg overflow-hidden relative ${l} flex items-center justify-center bg-red-50 dark:bg-red-900/20`,style:{height:n},children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("p",{className:"text-red-800 dark:text-red-200 font-semibold mb-2",children:"Map Error"}),e.jsx("p",{className:"text-red-600 dark:text-red-300 text-sm",children:p})]})}):e.jsx("div",{ref:m,className:`rounded-lg overflow-hidden relative ${l}`,style:{height:n},id:"native-map-container",children:e.jsx("div",{className:"absolute inset-0 bg-gray-200 dark:bg-gray-700",children:e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Native Map View"})})})})}function A(t){const{center:s,zoom:a=13,markers:r=[],height:n="400px",className:l="",onMapClick:i,onMarkerClick:o,showDirections:c=!1,destination:d}=t;if(S()){const t=r.map(e=>({position:[e.position.lat,e.position.lng],popup:e.popup||e.title,isSelected:e.isSelected}));return e.jsx(B,{center:[s.lat,s.lng],zoom:a,markers:t,height:n,className:l,onMapClick:i,onMarkerClick:o})}return _()||C()?e.jsx(G,{center:s,zoom:a,markers:r,height:n,className:l,onMapClick:i,onMarkerClick:o,showDirections:c,destination:d}):e.jsx("div",{className:`rounded-lg overflow-hidden bg-gray-100 dark:bg-gray-800 flex items-center justify-center ${l}`,style:{height:n},children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Map not available"})})}function L(t){return e.jsx(A,{...t})}function H({url:t,title:o,description:c="",hashtags:d=["PitBox","Racing","SetupSheet"],compact:m=!1}){const[u,h]=k.useState(!1),[p,x]=k.useState(!1),g=encodeURIComponent(t),f=encodeURIComponent(o),b=d.map(e=>e.replace("#","")).join(","),v=async()=>{try{await navigator.clipboard.writeText(t),h(!0),setTimeout(()=>h(!1),2e3)}catch(e){}},j=async()=>{if(navigator.share)try{await navigator.share({title:o,text:c,url:t})}catch(e){}else x(!p)},y=[{name:"Facebook",icon:a,url:`https://www.facebook.com/sharer/sharer.php?u=${g}`,color:"hover:bg-blue-600"},{name:"Twitter/X",icon:r,url:`https://twitter.com/intent/tweet?url=${g}&text=${f}&hashtags=${b}`,color:"hover:bg-gray-800"},{name:"Threads",icon:n,url:`https://www.threads.net/intent/post?text=${f}%20${g}`,color:"hover:bg-gray-900"}];return m?e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:j,className:"btn-secondary flex items-center gap-2","aria-label":"Share",children:[e.jsx(s,{className:"w-4 h-4"}),e.jsx("span",{children:"Share"})]}),p&&!navigator.share&&e.jsx("div",{className:"absolute top-full mt-2 right-0 bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 p-2 z-50 min-w-[200px]",children:e.jsxs("div",{className:"space-y-1",children:[y.map(t=>{const s=t.icon;return e.jsxs("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:`flex items-center gap-3 px-4 py-2 rounded-lg transition-colors ${t.color} hover:text-white`,onClick:()=>x(!1),children:[e.jsx(s,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:t.name})]},t.name)}),e.jsx("button",{onClick:v,className:"flex items-center gap-3 px-4 py-2 rounded-lg transition-colors hover:bg-brand-gold hover:text-white w-full",children:u?e.jsxs(e.Fragment,{children:[e.jsx(l,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Copied!"})]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Copy Link"})]})})]})})]}):e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400 font-medium",children:"Share:"}),y.map(t=>{const s=t.icon;return e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:`p-2 rounded-lg transition-all duration-200 bg-gray-100 dark:bg-gray-800 ${t.color} hover:text-white hover:scale-110`,"aria-label":`Share on ${t.name}`,children:e.jsx(s,{className:"w-5 h-5"})},t.name)}),e.jsx("button",{onClick:v,className:"p-2 rounded-lg transition-all duration-200 "+(u?"bg-green-500 text-white":"bg-gray-100 dark:bg-gray-800 hover:bg-brand-gold hover:text-white hover:scale-110"),"aria-label":"Copy link",children:u?e.jsx(l,{className:"w-5 h-5"}):e.jsx(i,{className:"w-5 h-5"})}),navigator.share&&e.jsx("button",{onClick:j,className:"p-2 rounded-lg transition-all duration-200 bg-gray-100 dark:bg-gray-800 hover:bg-brand-gold hover:text-white hover:scale-110","aria-label":"Share",children:e.jsx(s,{className:"w-5 h-5"})})]})}function q(){var a,r,n,i,k,_,C,S,E,U;const{postId:B}=R(),G=T(),{user:A}=$(),[q,J]=N.useState(null),[V,W]=N.useState(!0),[K,Y]=N.useState(null),[Z,X]=N.useState(""),[Q,ee]=N.useState(!1),[te,se]=N.useState(!1),[ae,re]=N.useState(!1),[ne,le]=N.useState(!1),[ie,oe]=N.useState(!1),[ce,de]=N.useState(!1),[me,ue]=N.useState(null),[he,pe]=N.useState(null),[xe,ge]=N.useState(!1),[fe,be]=N.useState(null),ve=N.useRef(null);N.useEffect(()=>{je(),we()},[B]);const je=async()=>{if(B)try{const{data:e,error:t}=await M.from("posts").select("\n          *,\n          profiles:user_id (\n            id,\n            username,\n            avatar_url,\n            full_name,\n            location\n          ),\n          post_likes (\n            id,\n            user_id\n          ),\n          post_comments (\n            id,\n            content,\n            created_at,\n            user_id,\n            profiles:user_id (\n              id,\n              username,\n              avatar_url,\n              full_name\n            )\n          )\n        ").eq("id",B).single();if(t)throw t;J(e),e&&J(t=>t?{...t,post_reactions:e.post_likes}:t),ye(B)}catch(e){Y("Failed to load post")}finally{W(!1)}},ye=e=>{const t=M.channel(`post-${e}`).on("postgres_changes",{event:"*",schema:"public",table:"post_likes",filter:`post_id=eq.${e}`},e=>{je()}).on("postgres_changes",{event:"*",schema:"public",table:"post_comments",filter:`post_id=eq.${e}`},e=>{je()}).subscribe();return()=>{t.unsubscribe()}},we=()=>{if(A&&B)try{const e=localStorage.getItem(`bookmarks_${A.id}`);if(e){const t=JSON.parse(e);ge(t.includes(B))}}catch(e){}},Ne=()=>{if(A&&B)try{const e=localStorage.getItem(`bookmarks_${A.id}`);let t=e?JSON.parse(e):[];xe?t=t.filter(e=>e!==B):t.push(B),localStorage.setItem(`bookmarks_${A.id}`,JSON.stringify(t)),ge(!xe)}catch(e){}},ke=async()=>{if(A&&q&&(Z.trim()||fe)){ee(!0);try{let e=Z.trim();fe&&(e=e?`${e} [GIF]${fe}[/GIF]`:`[GIF]${fe}[/GIF]`),me&&e&&(e=`@${me.username} ${e}`);const{error:t}=await M.from("post_comments").insert({post_id:q.id,user_id:A.id,content:e,reply_to_comment_id:(null==me?void 0:me.commentId)||null});if(t)throw t;X(""),be(null),ue(null),je()}catch(e){}finally{ee(!1)}}},_e=()=>{alert("Thank you for your report. Our team will review this post."),le(!1)},Ce=t=>{const s=/\[GIF\](.*?)\[\/GIF\]/g,a=[];let r,n=0;for(;null!==(r=s.exec(t));)r.index>n&&a.push(e.jsx("span",{children:t.slice(n,r.index)},n)),a.push(e.jsx("img",{src:r[1],alt:"GIF",className:"max-w-full rounded-lg mt-2",style:{maxHeight:"200px"}},r.index)),n=r.index+r[0].length;return n<t.length&&a.push(e.jsx("span",{children:t.slice(n)},n)),a.length>0?a:t},Se=e=>{try{const t=new Date(e),s=new Date;return Math.abs(s.getTime()-t.getTime())/36e5<24?O(t,{addSuffix:!0}):D(t,"MMM d, yyyy h:mm a")}catch(t){return"some time ago"}};return V?e.jsx("div",{className:"flex justify-center items-center min-h-[50vh]",children:e.jsx(t,{className:"w-8 h-8 animate-spin text-brand-gold"})}):K||!q?e.jsxs("div",{className:"glass-panel p-8 text-center",children:[e.jsx(o,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-bold mb-2",children:"Post Not Found"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"The post you're looking for doesn't exist or has been removed."}),e.jsxs("button",{onClick:()=>G("/community"),className:"btn-primary flex items-center gap-2 mx-auto",children:[e.jsx(c,{className:"w-5 h-5"}),"Back to Pit Community"]})]}):e.jsxs("div",{className:"max-w-2xl mx-auto",children:[e.jsxs("button",{onClick:()=>G("/community"),className:"mb-6 flex items-center gap-2 text-gray-600 dark:text-gray-400 hover:text-brand-gold transition-colors",children:[e.jsx(c,{className:"w-5 h-5"}),"Back to Community"]}),e.jsxs(d.div,{className:"glass-panel overflow-hidden",initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-start mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer",onClick:()=>{var e;return G(`/user/${null==(e=q.profiles)?void 0:e.id}`)},children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-brand-gold/10 flex items-center justify-center overflow-hidden",children:(null==(a=q.profiles)?void 0:a.avatar_url)?e.jsx("img",{src:q.profiles.avatar_url,alt:q.profiles.username,className:"w-full h-full object-cover"}):e.jsx(m,{className:"w-7 h-7 text-brand-gold"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-lg hover:underline",children:(null==(r=q.profiles)?void 0:r.full_name)||(null==(n=q.profiles)?void 0:n.username)}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(u,{className:"w-4 h-4"}),(e=>{try{const t=new Date(e);return D(t,"MMMM d, yyyy h:mm a")}catch(t){return"Unknown date"}})(q.created_at),q.location&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx(h,{className:"w-4 h-4"}),q.location]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>re(!ae),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full",children:e.jsx(p,{className:"w-5 h-5"})}),ae&&e.jsx("div",{className:"absolute right-0 mt-1 w-48 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-10",children:e.jsxs("div",{className:"py-1",children:[(null==A?void 0:A.id)===q.user_id&&e.jsx("button",{onClick:()=>{oe(!0),re(!1)},className:"w-full px-4 py-2 text-left text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700",children:"Delete Post"}),(null==A?void 0:A.id)===q.user_id&&e.jsx("button",{onClick:()=>{pe(q),re(!1)},className:"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700",children:"Edit Post"}),e.jsx("button",{onClick:()=>{le(!0),re(!1)},className:"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700",children:"Report Post"}),e.jsxs("button",{onClick:()=>{window.open(`/community/post/${q.id}`,"_blank"),re(!1)},className:"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4"}),"Open in New Tab"]}),e.jsx("button",{onClick:()=>{Ne(),re(!1)},className:"w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center gap-2",children:xe?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"w-4 h-4"}),"Unsave Post"]}):e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-4 h-4"}),"Save Post"]})})]})})]})]}),e.jsx("p",{className:"text-lg mb-6 whitespace-pre-wrap",children:q.content}),q.image_url&&e.jsx("div",{className:"w-full mb-6 flex justify-center",children:e.jsx("img",{src:q.image_url,alt:"Post content",className:"max-w-full h-auto rounded-lg",style:{maxHeight:"400px",objectFit:"contain"}})}),q.video_url&&e.jsx("div",{className:"w-full rounded-lg mb-6 overflow-hidden",children:e.jsx("div",{className:"relative pt-[56.25%]",children:e.jsx(P,{url:q.video_url,width:"100%",height:"100%",controls:!0,className:"absolute top-0 left-0"})})}),q.latitude&&q.longitude&&e.jsx("div",{className:"w-full h-[300px] rounded-lg mb-6 overflow-hidden",children:e.jsx(L,{center:{lat:q.latitude,lng:q.longitude},markers:[{position:{lat:q.latitude,lng:q.longitude},title:q.location||"Post Location",isSelected:!0}],height:"100%",zoom:14})}),e.jsxs("div",{className:"flex items-center gap-6 border-t border-b border-gray-200 dark:border-gray-700 py-4",children:[e.jsxs("button",{onClick:()=>(async()=>{if(A&&q)try{const{data:e}=await M.from("post_likes").select("id").eq("post_id",q.id).eq("user_id",A.id);e&&e.length>0?await M.from("post_likes").delete().eq("post_id",q.id).eq("user_id",A.id):await M.from("post_likes").insert({post_id:q.id,user_id:A.id}),J(e=>{var t,s;if(!e)return e;const a=(null==(t=e.post_reactions)?void 0:t.some(e=>e.user_id===A.id))?(null==(s=e.post_reactions)?void 0:s.filter(e=>e.user_id!==A.id))||[]:[...e.post_reactions||[],{user_id:A.id}];return{...e,post_reactions:a}})}catch(e){}})(),className:"flex items-center gap-2 text-gray-500 hover:text-red-500 transition-colors",children:[e.jsx(b,{className:"w-6 h-6 "+((null==(i=q.post_reactions)?void 0:i.some(e=>e.user_id===(null==A?void 0:A.id)))?"fill-current text-red-500":"")}),e.jsx("span",{className:"font-medium",children:(null==(k=q.post_reactions)?void 0:k.length)||0})]}),e.jsxs("button",{onClick:()=>{var e;return null==(e=ve.current)?void 0:e.focus()},className:"flex items-center gap-2 text-gray-500 hover:text-brand-gold transition-colors",children:[e.jsx(v,{className:"w-6 h-6"}),e.jsx("span",{className:"font-medium",children:(null==(_=q.post_comments)?void 0:_.length)||0})]}),e.jsxs("button",{onClick:async()=>{var e;const t=`${window.location.origin}/community/post/${null==q?void 0:q.id}`,s=`Check out this post from ${(null==(e=null==q?void 0:q.profiles)?void 0:e.username)||"a racer"} on PitBox.App!`;try{navigator.share?await navigator.share({title:"PitBox.App Post",text:s,url:t}):await navigator.clipboard.writeText(t),se(!0),setTimeout(()=>se(!1),2e3)}catch(a){a instanceof Error&&a.name}},className:"flex items-center gap-2 text-gray-500 hover:text-brand-gold transition-colors",children:[te?e.jsx(l,{className:"w-6 h-6 text-green-500"}):e.jsx(s,{className:"w-6 h-6"}),e.jsx("span",{className:"font-medium",children:te?"Copied!":"Share"})]}),e.jsx("button",{onClick:Ne,className:"flex items-center gap-2 text-gray-500 hover:text-brand-gold transition-colors ml-auto",children:xe?e.jsx(g,{className:"w-6 h-6 fill-current text-brand-gold"}):e.jsx(f,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"px-6 pb-6 pt-2 border-t border-gray-200 dark:border-gray-700",children:e.jsx(H,{url:`${window.location.origin}/community/post/${q.id}`,title:q.content.substring(0,100),description:`Check out this post from ${(null==(C=q.profiles)?void 0:C.username)||"Pit Community"}`,hashtags:["PitBox","Racing","PitCommunity"]})})]}),e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 p-6",children:[e.jsxs("h3",{className:"font-semibold mb-4",children:[(null==(S=q.post_comments)?void 0:S.length)||0," Comments"]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex gap-3 items-start",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-gold/10 flex items-center justify-center overflow-hidden flex-shrink-0",children:(null==(E=null==A?void 0:A.user_metadata)?void 0:E.avatar_url)?e.jsx("img",{src:A.user_metadata.avatar_url,alt:"Your avatar",className:"w-full h-full object-cover"}):e.jsx(m,{className:"w-6 h-6 text-brand-gold"})}),e.jsxs("div",{className:"flex-1",children:[fe&&e.jsxs("div",{className:"mb-2 relative inline-block",children:[e.jsx("img",{src:fe,alt:"Selected GIF",className:"max-w-xs rounded-lg",style:{maxHeight:"150px"}}),e.jsx("button",{onClick:()=>be(null),className:"absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600",children:e.jsx(j,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{ref:ve,type:"text",value:Z,onChange:e=>X(e.target.value),placeholder:me?`Reply to @${me.username}...`:"Write a comment...",className:"w-full pr-24 py-2 px-4 rounded-full bg-white dark:bg-gray-700 border border-gray-200 dark:border-gray-600",onKeyPress:e=>{"Enter"===e.key&&(Z.trim()||fe)&&ke()}}),e.jsxs("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1",children:[e.jsx(F,{onGifSelect:e=>{be(e)}}),e.jsx(I,{onEmojiSelect:e=>{X(t=>t+e)},theme:document.documentElement.classList.contains("dark")?"dark":"light"}),e.jsx("button",{onClick:ke,disabled:!Z.trim()&&!fe||Q,className:"p-2 text-brand-gold hover:bg-brand-gold/10 rounded-full transition-colors disabled:opacity-50",children:Q?e.jsx(t,{className:"w-5 h-5 animate-spin"}):e.jsx(y,{className:"w-5 h-5"})})]})]})]})]})}),me&&e.jsxs("div",{className:"flex items-center gap-2 mb-3 ml-12 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx(w,{className:"w-4 h-4"}),e.jsxs("span",{children:["Replying to @",me.username]}),e.jsx("button",{onClick:()=>ue(null),className:"text-brand-gold hover:underline",children:"Cancel"})]}),e.jsx("div",{className:"space-y-6",children:null==(U=q.post_comments)?void 0:U.map(t=>{var s,a,r;return e.jsxs(d.div,{className:"flex gap-3",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.3},children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-gold/10 flex items-center justify-center overflow-hidden flex-shrink-0 cursor-pointer",onClick:()=>{var e;return G(`/user/${null==(e=t.profiles)?void 0:e.id}`)},children:(null==(s=t.profiles)?void 0:s.avatar_url)?e.jsx("img",{src:t.profiles.avatar_url,alt:t.profiles.username,className:"w-full h-full object-cover"}):e.jsx(m,{className:"w-6 h-6 text-brand-gold"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-700 rounded-lg px-4 py-2",children:[e.jsx("p",{className:"font-semibold hover:underline cursor-pointer",onClick:()=>{var e;return G(`/user/${null==(e=t.profiles)?void 0:e.id}`)},children:(null==(a=t.profiles)?void 0:a.full_name)||(null==(r=t.profiles)?void 0:r.username)}),e.jsx("div",{children:Ce(t.content)})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 dark:text-gray-400 mt-1 ml-4",children:[e.jsx("span",{children:Se(t.created_at)}),e.jsx("button",{className:"hover:text-brand-gold",onClick:()=>{var e;ue({commentId:t.id,username:(null==(e=t.profiles)?void 0:e.username)||"user"}),X(""),setTimeout(()=>{var e;null==(e=ve.current)||e.focus()},100)},children:"Reply"}),e.jsx("button",{className:"hover:text-brand-gold",children:"Like"}),e.jsxs("button",{className:"hover:text-brand-gold",children:[e.jsx(Smile,{className:"w-4 h-4"}),"React"]})]})]})]},t.id)})})]})]}),ie&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Delete Post"}),e.jsx("p",{className:"mb-6",children:"Are you sure you want to delete this post? This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end gap-4",children:[e.jsx("button",{onClick:()=>oe(!1),className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(A&&q){de(!0);try{if(A.id!==q.user_id)throw new Error("You can only delete your own posts");if(q.image_url)try{const e=new URL(q.image_url).pathname.split("/"),t=e.slice(e.indexOf("posts")+1).join("/");t&&await M.storage.from("posts").remove([t])}catch(e){}if(q.video_url)try{const e=new URL(q.video_url).pathname.split("/"),t=e.slice(e.indexOf("videos")+1).join("/");t&&await M.storage.from("videos").remove([t])}catch(e){}const{error:t}=await M.from("posts").delete().eq("id",q.id);if(t)throw t;G("/community")}catch(t){Y("Failed to delete post")}finally{de(!1),oe(!1)}}},disabled:ce,className:"px-4 py-2 bg-red-500 text-white rounded-lg flex items-center gap-2",children:ce?e.jsxs(e.Fragment,{children:[e.jsx(t,{className:"w-5 h-5 animate-spin"}),"Deleting..."]}):"Delete"})]})]})}),ne&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Report Post"}),e.jsx("p",{className:"mb-4",children:"Why are you reporting this post?"}),e.jsx("div",{className:"space-y-2 mb-6",children:["Inappropriate content","Spam","Harassment","False information","Other"].map(t=>e.jsx("button",{onClick:_e,className:"w-full text-left px-4 py-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:t},t))}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>le(!1),className:"px-4 py-2 bg-gray-100 dark:bg-gray-700 rounded-lg",children:"Cancel"})})]})}),e.jsx(z,{isOpen:!!he,onClose:()=>pe(null),post:he||void 0})]})}export{q as default};

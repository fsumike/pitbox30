import{j as e,V as s,ae as t,$ as a,ak as r,aF as l,a0 as o,Q as n,X as i}from"./ui-a5pT2S0L.js";import{r as d}from"./react-CLW9qjVv.js";import{u as c}from"./useShocks-Bo_tGHwI.js";import{C as u,h,j as x,k as g}from"./index-DMaHBciH.js";import"./supabase-Dols_XF-.js";import"./router-CsjlwGXH.js";function m(){const{shocks:m,loading:b,addShock:f,updateShock:y,deleteShock:p,refreshShocks:j,getSignedUrlForShock:N}=c(),[v,w]=d.useState(""),[k,_]=d.useState(!1),[S,C]=d.useState(!1),[D,F]=d.useState(!1),[L,A]=d.useState(null),[P,T]=d.useState({serial_number:"",notes:"",last_refurbished:""}),[U,R]=d.useState(null),[$,E]=d.useState(null),[z,B]=d.useState(!1),[I,O]=d.useState(null),[V,q]=d.useState(new Set),G=d.useRef(null),Q=m.filter((e=>e.serial_number.toLowerCase().includes(v.toLowerCase()))),H=async()=>{var e;try{if(u.isNativePlatform()){const e=await h.getPhoto({quality:90,resultType:x.DataUrl,source:g.Camera,saveToGallery:!1,allowEditing:!1});if(e.dataUrl){const s=await fetch(e.dataUrl),t=await s.blob(),a=new File([t],`dyno-${Date.now()}.jpg`,{type:"image/jpeg"});R(a),E(e.dataUrl)}}else null==(e=G.current)||e.click()}catch(s){alert("Failed to take photo. Please try again.")}},J=e=>{var s;const t=null==(s=e.target.files)?void 0:s[0];if(t){R(t);const e=new FileReader;e.onloadend=()=>{E(e.result)},e.readAsDataURL(t)}},K=()=>{T({serial_number:"",notes:"",last_refurbished:""}),R(null),E(null),A(null),O(null)},M=()=>{R(null),E(null)};return b?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Shock Inventory"}),e.jsxs("button",{onClick:()=>_(!0),className:"flex items-center gap-2 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors",children:[e.jsx(s,{className:"w-5 h-5"}),"Add Shock"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(t,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by serial number...",value:v,onChange:e=>w(e.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),0===Q.length?e.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-lg border border-gray-700",children:[e.jsx(a,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:v?"No shocks found":"No shocks in inventory. Add your first shock!"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:Q.map((s=>e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4 hover:border-orange-500 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-1",children:s.serial_number}),s.last_refurbished&&e.jsxs("p",{className:"text-sm text-gray-400 flex items-center gap-1",children:[e.jsx(r,{className:"w-4 h-4"}),"Refurbished: ",new Date(s.last_refurbished).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>(e=>{A(e),T({serial_number:e.serial_number,notes:e.notes||"",last_refurbished:e.last_refurbished?new Date(e.last_refurbished).toISOString().split("T")[0]:""}),R(null),E(e.dyno_photo_url),C(!0)})(s),className:"p-2 text-gray-400 hover:text-orange-500 transition-colors",children:e.jsx(l,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>(async e=>{if(confirm(`Delete shock ${e.serial_number}? This cannot be undone.`))try{await p(e.id)}catch(s){alert(s instanceof Error?s.message:"Failed to delete shock")}})(s),className:"p-2 text-gray-400 hover:text-red-500 transition-colors",children:e.jsx(o,{className:"w-4 h-4"})})]})]}),s.dyno_photo_url?e.jsxs("div",{onClick:()=>(e=>{A(e),F(!0)})(s),className:"relative aspect-video bg-gray-900 rounded-lg overflow-hidden cursor-pointer group",children:[e.jsx("img",{src:s.dyno_photo_url,alt:`Dyno sheet for ${s.serial_number}`,className:"w-full h-full object-cover group-hover:opacity-80 transition-opacity",onLoad:()=>{},onError:e=>(async(e,s)=>{if(!V.has(e.id)){q((s=>new Set(s).add(e.id)));try{const t=await N(e);t&&t!==e.dyno_photo_url&&(s.src=t,setTimeout((()=>{q((s=>{const t=new Set(s);return t.delete(e.id),t}))}),1e3))}catch(t){}}})(s,e.currentTarget),loading:"lazy"},`${s.id}-${s.dyno_photo_url}`),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"bg-black/50 px-4 py-2 rounded-lg text-white text-sm",children:"View Full Size"})})]}):e.jsx("div",{className:"aspect-video bg-gray-900 rounded-lg flex items-center justify-center",children:e.jsx(n,{className:"w-8 h-8 text-gray-600"})}),s.notes&&e.jsx("p",{className:"mt-3 text-sm text-gray-400 line-clamp-2",children:s.notes})]},s.id)))}),k&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-gray-900 rounded-lg max-w-lg w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Add New Shock"}),e.jsx("button",{onClick:()=>{_(!1),K()},className:"text-gray-400 hover:text-white",children:e.jsx(i,{className:"w-6 h-6"})})]}),I&&e.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500 rounded-lg text-red-200 text-sm",children:I}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Serial Number *"}),e.jsx("input",{type:"text",value:P.serial_number,onChange:e=>T({...P,serial_number:e.target.value}),placeholder:"e.g., 1234, ABCD, 12AB...",className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Dyno Sheet Photo"}),$?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:$,alt:"Dyno sheet preview",className:"w-full rounded-lg"}),e.jsx("button",{onClick:M,className:"absolute top-2 right-2 p-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:e.jsx(i,{className:"w-4 h-4"})})]}):e.jsxs("button",{onClick:H,className:"w-full py-8 border-2 border-dashed border-gray-700 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-orange-500 transition-colors",children:[e.jsx(a,{className:"w-8 h-8 text-gray-400"}),e.jsx("span",{className:"text-gray-400",children:"Take/Upload Photo"})]}),e.jsx("input",{ref:G,type:"file",accept:"image/*",onChange:J,className:"hidden"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Last Refurbished"}),e.jsx("input",{type:"date",value:P.last_refurbished,onChange:e=>T({...P,last_refurbished:e.target.value}),className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Notes"}),e.jsx("textarea",{value:P.notes,onChange:e=>T({...P,notes:e.target.value}),placeholder:"Optional notes about this shock...",rows:3,className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>{_(!1),K()},className:"flex-1 px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition-colors",disabled:z,children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(P.serial_number.trim())try{B(!0),O(null),await f(P.serial_number,U||void 0,P.notes||void 0,P.last_refurbished||void 0),K(),_(!1)}catch(e){const s=e instanceof Error?e.message:"Failed to add shock";O(s)}finally{B(!1)}else O("Please enter a shock serial number")},disabled:z,className:"flex-1 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors disabled:opacity-50",children:z?"Adding...":"Add Shock"})]})]})})}),S&&L&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-gray-900 rounded-lg max-w-lg w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Edit Shock"}),e.jsx("button",{onClick:()=>{C(!1),K()},className:"text-gray-400 hover:text-white",children:e.jsx(i,{className:"w-6 h-6"})})]}),I&&e.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500 rounded-lg text-red-200 text-sm",children:I}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Serial Number *"}),e.jsx("input",{type:"text",value:P.serial_number,onChange:e=>T({...P,serial_number:e.target.value}),className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Dyno Sheet Photo"}),$?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:$,alt:"Dyno sheet preview",className:"w-full rounded-lg"}),e.jsx("button",{onClick:()=>{M(),U||R(null)},className:"absolute top-2 right-2 p-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:e.jsx(o,{className:"w-4 h-4"})})]}):e.jsxs("button",{onClick:H,className:"w-full py-8 border-2 border-dashed border-gray-700 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-orange-500 transition-colors",children:[e.jsx(a,{className:"w-8 h-8 text-gray-400"}),e.jsx("span",{className:"text-gray-400",children:"Take/Upload New Photo"})]}),e.jsx("input",{ref:G,type:"file",accept:"image/*",onChange:J,className:"hidden"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Last Refurbished"}),e.jsx("input",{type:"date",value:P.last_refurbished,onChange:e=>T({...P,last_refurbished:e.target.value}),className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Notes"}),e.jsx("textarea",{value:P.notes,onChange:e=>T({...P,notes:e.target.value}),rows:3,className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>{C(!1),K()},className:"flex-1 px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition-colors",disabled:z,children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(L)try{B(!0),O(null),await y(L.id,{serial_number:P.serial_number,notes:P.notes||void 0,last_refurbished:P.last_refurbished||void 0,dyno_photo:null===U?null:U||void 0}),K(),C(!1)}catch(e){const s=e instanceof Error?e.message:"Failed to update shock";O(s)}finally{B(!1)}},disabled:z,className:"flex-1 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors disabled:opacity-50",children:z?"Saving...":"Save Changes"})]})]})})}),D&&L&&L.dyno_photo_url&&e.jsx("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4",onClick:()=>F(!1),children:e.jsxs("div",{className:"relative max-w-4xl w-full",children:[e.jsx("button",{onClick:()=>F(!1),className:"absolute -top-12 right-0 text-white hover:text-orange-500 transition-colors",children:e.jsx(i,{className:"w-8 h-8"})}),e.jsx("img",{src:L.dyno_photo_url,alt:`Dyno sheet for ${L.serial_number}`,className:"w-full h-auto rounded-lg"}),e.jsxs("div",{className:"mt-4 text-center text-white",children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Shock: ",L.serial_number]}),L.last_refurbished&&e.jsxs("p",{className:"text-gray-400 mt-1",children:["Last Refurbished:"," ",new Date(L.last_refurbished).toLocaleDateString()]})]})]})})]})}export{m as default};

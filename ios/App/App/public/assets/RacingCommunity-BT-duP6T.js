import{j as e,a4 as t,X as s,U as a,p as r,h as l,av as i,m as n,e as o,ai as c,at as d,H as m,aw as u,a9 as x,al as h,af as f,$ as g,ax as p,Q as b,ay as j,W as v,az as w,Z as y,x as N,aA as k,w as _,k as C,aB as S,V as T,a0 as E,C as R,q as I,aC as P,aD as $,n as q,a8 as F,aE as z,L as M,M as U,au as D,aF as O,ah as H,aG as L,J as A,aH as B,Y as G,a as Y}from"./ui-v2ReSvUE.js";import{r as V}from"./react-YWE4JMTy.js";import{u as W,c as X,s as J,h as K,j as Q,k as Z,l as ee}from"./index-Cgc97SP_.js";import{R as te,G as se,E as ae,C as re}from"./GifPicker-BGwibceY.js";import{f as le}from"./formatDistanceToNow-C1OK0Che.js";import{u as ie}from"./router-BNBI7_bc.js";import{u as ne}from"./usePosts-DDWljK8j.js";import{f as oe}from"./format-DltpeZFQ.js";import"./supabase-Du4GZSDg.js";import"./useLocation-D3TBQNJQ.js";function ce(){const[l,i]=V.useState(!1),[n,o]=V.useState([]),[c,d]=V.useState(!1),[m,u]=V.useState(0),{user:x}=W(),{startChat:h}=X();V.useEffect(()=>{x&&l&&g()},[x,l]),V.useEffect(()=>{if(x){f();const e=setInterval(f,3e4);return()=>clearInterval(e)}},[x]);const f=async()=>{if(x)try{const{count:e}=await J.from("messages").select("*",{count:"exact",head:!0}).eq("receiver_id",x.id).eq("read",!1);u(e||0)}catch(e){}},g=async()=>{if(x){d(!0);try{const{data:e}=await J.from("messages").select("\n          id,\n          sender_id,\n          receiver_id,\n          content,\n          created_at,\n          read,\n          sender:profiles!messages_sender_id_fkey(id, username, avatar_url),\n          receiver:profiles!messages_receiver_id_fkey(id, username, avatar_url)\n        ").or(`sender_id.eq.${x.id},receiver_id.eq.${x.id}`).order("created_at",{ascending:!1});if(!e)return o([]),void d(!1);const t=new Map;e.forEach(e=>{const s=e.sender_id===x.id?e.receiver_id:e.sender_id,a=e.sender_id===x.id?e.receiver:e.sender;t.has(s)||t.set(s,{id:s,other_user_id:s,username:(null==a?void 0:a.username)||"Unknown User",avatar_url:(null==a?void 0:a.avatar_url)||null,last_message:e.content,last_message_time:e.created_at,unread_count:0}),e.receiver_id!==x.id||e.read||t.get(s).unread_count++}),o(Array.from(t.values()))}catch(e){}finally{d(!1)}}};return x?e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>i(!0),className:"relative flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white rounded-lg shadow-sm transition-all duration-200 hover:shadow-md",title:"Messages",children:[e.jsx(t,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline font-medium",children:"Messages"}),m>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold",children:m>9?"9+":m})]}),l&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-start justify-center p-4 bg-black/50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-md mt-20 max-h-[80vh] flex flex-col",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(t,{className:"w-5 h-5 text-brand-gold"}),e.jsx("h2",{className:"text-lg font-bold",children:"Messages"}),m>0&&e.jsx("span",{className:"bg-red-500 text-white text-xs rounded-full px-2 py-0.5",children:m})]}),e.jsx("button",{onClick:()=>i(!1),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:e.jsx(s,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:c?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-gold"})}):0===n.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 px-4 text-center",children:[e.jsx(t,{className:"w-16 h-16 text-gray-300 dark:text-gray-600 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No messages yet"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Start a conversation by messaging someone from their profile"})]}):e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-gray-700",children:n.map(t=>e.jsx("button",{onClick:()=>{return e=t.other_user_id,h(e),void i(!1);var e},className:"w-full p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors text-left",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[t.avatar_url?e.jsx("img",{src:t.avatar_url,alt:t.username,className:"w-12 h-12 rounded-full object-cover"}):e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-brand-gold to-amber-600 flex items-center justify-center",children:e.jsx(a,{className:"w-6 h-6 text-white"})}),t.unread_count>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold",children:t.unread_count})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h3",{className:"font-semibold truncate "+(t.unread_count>0?"text-gray-900 dark:text-white":"text-gray-700 dark:text-gray-300"),children:t.username}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 dark:text-gray-400",children:[e.jsx(r,{className:"w-3 h-3"}),e.jsx("span",{children:le(new Date(t.last_message_time),{addSuffix:!0})})]})]}),e.jsx("p",{className:"text-sm truncate "+(t.unread_count>0?"font-medium text-gray-900 dark:text-white":"text-gray-500 dark:text-gray-400"),children:t.last_message})]})]})},t.id))})})]})})]}):null}function de({className:t=""}){const s=ie(),{user:a}=W(),[r,i]=V.useState(0);V.useEffect(()=>{if(a){n();const e=setInterval(n,3e4);return()=>clearInterval(e)}},[a]);const n=async()=>{if(a)try{const{count:e}=await J.from("friend_requests").select("*",{count:"exact",head:!0}).eq("receiver_id",a.id).eq("status","pending");i(e||0)}catch(e){}};return e.jsxs("button",{onClick:()=>s("/friends"),className:`relative flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white rounded-lg shadow-sm transition-all duration-200 hover:shadow-md ${t}`,title:"Friends",children:[e.jsx(l,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline font-medium",children:"Friends"}),r>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold",children:r>9?"9+":r})]})}function me({className:s=""}){const[r,l]=V.useState(!1),{notifications:u,unreadCount:x,markAsRead:h,markAllAsRead:f,requestNotificationPermission:g}=function(){const{user:e}=W(),[t,s]=V.useState(!1),[a,r]=V.useState(null),[l,i]=V.useState([]),[n,o]=V.useState(0);V.useEffect(()=>{e&&(d(),c())},[e]);const c=()=>{if(!e)return;const t=J.channel("notifications").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`user_id=eq.${e.id}`},e=>{if(d(),"Notification"in window&&"granted"===Notification.permission){const t=e.new;new Notification("PitBox.App",{body:t.content,icon:"/android-icon-192-192.png"})}}).subscribe();return()=>{t.unsubscribe()}},d=async()=>{if(e){s(!0),r(null);try{const{data:t,error:s}=await J.from("notifications").select("\n          *,\n          related_user:related_user_id (\n            id,\n            username,\n            avatar_url,\n            full_name\n          )\n        ").eq("user_id",e.id).order("created_at",{ascending:!1}).limit(50);if(s)throw s;i(t||[]);const a=(t||[]).filter(e=>!e.read).length;return o(a),t}catch(t){return r("Failed to load notifications"),[]}finally{s(!1)}}};return{notifications:l,unreadCount:n,loading:t,error:a,loadNotifications:d,markAsRead:async t=>{if(!e)return!1;try{const{error:s}=await J.from("notifications").update({read:!0}).eq("id",t).eq("user_id",e.id);if(s)throw s;return i(e=>e.map(e=>e.id===t?{...e,read:!0}:e)),o(e=>Math.max(0,e-1)),!0}catch(s){return!1}},markAllAsRead:async()=>{if(!e)return!1;try{const{error:t}=await J.from("notifications").update({read:!0}).eq("user_id",e.id).eq("read",!1);if(t)throw t;return i(e=>e.map(e=>({...e,read:!0}))),o(0),!0}catch(t){return!1}},requestNotificationPermission:async()=>"Notification"in window&&("granted"===Notification.permission||"denied"!==Notification.permission&&"granted"===await Notification.requestPermission())}}(),p=V.useRef(null),b=ie();V.useEffect(()=>{g()},[]),V.useEffect(()=>{const e=e=>{p.current&&!p.current.contains(e.target)&&l(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);const j=s=>{switch(s){case"like":return e.jsx(m,{className:"w-4 h-4 text-red-500"});case"comment":return e.jsx(t,{className:"w-4 h-4 text-blue-500"});case"friend_request":return e.jsx(d,{className:"w-4 h-4 text-green-500"});case"mention":return e.jsx(a,{className:"w-4 h-4 text-purple-500"});default:return e.jsx(i,{className:"w-4 h-4 text-brand-gold"})}};return e.jsxs("div",{className:`relative ${s}`,ref:p,children:[e.jsxs("button",{onClick:()=>l(!r),className:"relative flex items-center gap-2 px-3 py-2 bg-gradient-to-r from-amber-500 to-amber-600 hover:from-amber-600 hover:to-amber-700 text-white rounded-lg shadow-sm transition-all duration-200 hover:shadow-md","aria-label":"Notifications",children:[e.jsx(i,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline font-medium",children:"Alerts"}),x>0&&e.jsx(n.span,{className:"absolute -top-1 -right-1 flex items-center justify-center min-w-5 h-5 px-1 bg-red-500 text-white text-xs font-bold rounded-full",initial:{scale:0},animate:{scale:1},transition:{type:"spring",stiffness:500,damping:15},children:x>9?"9+":x})]}),e.jsx(o,{children:r&&e.jsxs(n.div,{className:"absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700 z-50 overflow-hidden",initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:[e.jsxs("div",{className:"p-3 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[e.jsx("h3",{className:"font-semibold",children:"Notifications"}),x>0&&e.jsxs("button",{onClick:()=>f(),className:"text-sm text-brand-gold hover:underline flex items-center gap-1",children:[e.jsx(c,{className:"w-3 h-3"}),"Mark all as read"]})]}),e.jsx("div",{className:"max-h-96 overflow-y-auto",children:0===u.length?e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No notifications yet"}):u.map(t=>{var s;return e.jsx(n.div,{className:"p-3 border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors cursor-pointer "+(t.read?"":"bg-blue-50 dark:bg-blue-900/20"),initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},onClick:()=>(e=>{h(e.id),e.post_id?b(`/community/post/${e.post_id}`):"friend_request"===e.type?b("/friends"):e.related_user_id&&b(`/user/${e.related_user_id}`),l(!1)})(t),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-brand-gold/10 flex items-center justify-center overflow-hidden flex-shrink-0",children:(null==(s=t.related_user)?void 0:s.avatar_url)?e.jsx("img",{src:t.related_user.avatar_url,alt:t.related_user.username,className:"w-full h-full object-cover"}):e.jsx(a,{className:"w-5 h-5 text-brand-gold"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[j(t.type),e.jsx("p",{className:"text-sm",children:t.content})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:le(new Date(t.created_at),{addSuffix:!0})})]}),!t.read&&e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500 mt-2"})]})},t.id)})}),u.length>0&&e.jsx("div",{className:"p-2 border-t border-gray-200 dark:border-gray-700 text-center",children:e.jsx("button",{onClick:()=>b("/notifications"),className:"text-sm text-brand-gold hover:underline",children:"View all notifications"})})]})})]})}function ue({activeTab:t,onTabChange:s}){return e.jsx(n.div,{className:"fixed bottom-0 left-0 right-0 z-50 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 shadow-lg safe-area-bottom md:hidden",initial:{y:100},animate:{y:0},transition:{type:"spring",damping:20,stiffness:300},children:e.jsxs("div",{className:"flex justify-around items-center h-16",children:[e.jsxs("button",{onClick:()=>s("all"),className:"flex flex-col items-center justify-center w-full h-full "+("all"===t?"text-brand-gold":"text-gray-500"),children:[e.jsx(u,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs mt-1",children:"Discover"})]}),e.jsxs("button",{onClick:()=>s("trending"),className:"flex flex-col items-center justify-center w-full h-full "+("trending"===t?"text-brand-gold":"text-gray-500"),children:[e.jsx(x,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs mt-1",children:"Trending"})]}),e.jsxs("button",{onClick:()=>s("friends"),className:"flex flex-col items-center justify-center w-full h-full "+("friends"===t?"text-brand-gold":"text-gray-500"),children:[e.jsx(l,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs mt-1",children:"Friends"})]}),e.jsxs("button",{onClick:()=>s("mine"),className:"flex flex-col items-center justify-center w-full h-full "+("mine"===t?"text-brand-gold":"text-gray-500"),children:[e.jsx(h,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs mt-1",children:"My Posts"})]}),e.jsxs("button",{onClick:()=>s("bookmarks"),className:"flex flex-col items-center justify-center w-full h-full "+("bookmarks"===t?"text-brand-gold":"text-gray-500"),children:[e.jsx(f,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs mt-1",children:"Saved"})]})]})})}const xe=[{name:"none",icon:e.jsx(y,{className:"w-5 h-5"}),label:"Normal",css:"none"},{name:"grayscale",icon:e.jsx(N,{className:"w-5 h-5"}),label:"B&W",css:"grayscale(100%)"},{name:"sepia",icon:e.jsx(k,{className:"w-5 h-5"}),label:"Sepia",css:"sepia(80%)"},{name:"warm",icon:e.jsx(_,{className:"w-5 h-5"}),label:"Warm",css:"saturate(1.3) hue-rotate(-10deg)"},{name:"cool",icon:e.jsx(k,{className:"w-5 h-5"}),label:"Cool",css:"saturate(1.2) hue-rotate(10deg) brightness(1.1)"},{name:"vibrant",icon:e.jsx(C,{className:"w-5 h-5"}),label:"Vibrant",css:"saturate(1.8) contrast(1.2)"},{name:"vintage",icon:e.jsx(S,{className:"w-5 h-5"}),label:"Vintage",css:"sepia(40%) saturate(0.8) contrast(1.1)"},{name:"dramatic",icon:e.jsx(S,{className:"w-5 h-5"}),label:"Drama",css:"contrast(1.5) saturate(0.8) brightness(0.9)"}];function he({isOpen:t,onClose:a,onSuccess:r}){var l,i;const[c,d]=V.useState("select"),[m,u]=V.useState("image"),[x,h]=V.useState(null),[f,y]=V.useState("none"),[N,k]=V.useState(!1),[_,C]=V.useState(0),[S,T]=V.useState(!1),[E,R]=V.useState(null),[I,P]=V.useState("user"),$=V.useRef(null),q=V.useRef(null),F=V.useRef(null),z=V.useRef([]),M=V.useRef(null),{user:U}=W();V.useEffect(()=>{},[t]),V.useEffect(()=>("camera"!==c||E||D(),()=>{O()}),[c]),V.useEffect(()=>()=>{M.current&&clearInterval(M.current)},[]);const D=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:I,width:{ideal:1080},height:{ideal:1920}},audio:"video"===m});R(e),$.current&&($.current.srcObject=e)}catch(e){alert("Camera access denied. Please enable camera permissions.")}},O=()=>{E&&(E.getTracks().forEach(e=>e.stop()),R(null))},H=()=>{F.current&&N&&(F.current.stop(),k(!1),M.current&&clearInterval(M.current))},L=async e=>{try{const t=await K.getPhoto({resultType:Z.Uri,source:Q.Photos,quality:90});t.webPath&&(h(t.webPath),u(e),d("preview"))}catch(t){const s=document.createElement("input");s.type="file",s.accept="image"===e?"image/*":"video/*",s.onchange=t=>{var s;const a=null==(s=t.target.files)?void 0:s[0];if(a){const t=URL.createObjectURL(a);h(t),u(e),d("preview")}},s.click()}},A=()=>{O(),d("select"),h(null),u("image"),y("none"),k(!1),C(0),a()};return e.jsx(o,{children:t&&e.jsxs(n.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[99999] bg-black",children:[e.jsx("button",{onClick:A,className:"absolute left-4 z-50 p-2 bg-black/50 text-white rounded-full backdrop-blur-sm hover:bg-black/70 transition-colors",style:{top:"max(env(safe-area-inset-top, 0px) + 1rem, 1rem)"},children:e.jsx(s,{className:"w-6 h-6"})}),"select"===c&&e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4 p-8 max-w-md w-full",children:[e.jsxs(n.button,{onClick:()=>{u("image"),d("camera")},className:"aspect-square bg-gradient-to-br from-blue-500 to-purple-500 rounded-2xl flex flex-col items-center justify-center gap-4 text-white hover:scale-105 transition-transform",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(g,{className:"w-12 h-12"}),e.jsx("span",{className:"font-bold",children:"Take Photo"})]}),e.jsxs(n.button,{onClick:()=>{u("video"),d("camera")},className:"aspect-square bg-gradient-to-br from-pink-500 to-red-500 rounded-2xl flex flex-col items-center justify-center gap-4 text-white hover:scale-105 transition-transform",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(p,{className:"w-12 h-12"}),e.jsx("span",{className:"font-bold",children:"Record Video"})]}),e.jsxs(n.button,{onClick:()=>L("image"),className:"aspect-square bg-gradient-to-br from-green-500 to-teal-500 rounded-2xl flex flex-col items-center justify-center gap-4 text-white hover:scale-105 transition-transform",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(b,{className:"w-12 h-12"}),e.jsx("span",{className:"font-bold",children:"Upload Photo"})]}),e.jsxs(n.button,{onClick:()=>L("video"),className:"aspect-square bg-gradient-to-br from-orange-500 to-yellow-500 rounded-2xl flex flex-col items-center justify-center gap-4 text-white hover:scale-105 transition-transform",whileHover:{scale:1.05},whileTap:{scale:.95},children:[e.jsx(j,{className:"w-12 h-12"}),e.jsx("span",{className:"font-bold",children:"Upload Video"})]})]})}),"camera"===c&&e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center bg-black",children:[e.jsx("video",{ref:$,autoPlay:!0,playsInline:!0,muted:!0,className:"max-w-full max-h-full object-contain",style:{filter:null==(l=xe.find(e=>e.name===f))?void 0:l.css}}),e.jsx("canvas",{ref:q,className:"hidden"}),N&&e.jsxs("div",{className:"absolute top-4 left-1/2 transform -translate-x-1/2 bg-red-500 text-white px-4 py-2 rounded-full font-bold flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-white rounded-full animate-pulse"}),_,"s / 15s"]}),e.jsx("div",{className:"absolute top-20 left-0 right-0 flex justify-center gap-2 px-4 overflow-x-auto pb-2",children:xe.map(t=>e.jsxs("button",{onClick:()=>y(t.name),className:"flex-shrink-0 flex flex-col items-center gap-1 p-2 rounded-lg transition-all "+(f===t.name?"bg-white text-black":"bg-black/50 text-white"),children:[t.icon,e.jsx("span",{className:"text-xs font-semibold",children:t.label})]},t.name))}),e.jsxs("div",{className:"absolute bottom-8 left-0 right-0 flex items-center justify-center gap-8",children:[e.jsx("button",{onClick:async()=>{O(),P(e=>"user"===e?"environment":"user"),setTimeout(D,100)},className:"p-4 bg-white/20 rounded-full backdrop-blur-sm hover:bg-white/30 transition-colors",children:e.jsx(v,{className:"w-6 h-6 text-white"})}),"image"===m?e.jsx("button",{onClick:async()=>{var e;if(!$.current||!q.current)return;const t=q.current,s=$.current;t.width=s.videoWidth,t.height=s.videoHeight;const a=t.getContext("2d");a&&(a.filter=(null==(e=xe.find(e=>e.name===f))?void 0:e.css)||"none",a.drawImage(s,0,0),t.toBlob(async e=>{if(e){const t=URL.createObjectURL(e);h(t),d("preview"),O()}},"image/jpeg",.95))},className:"w-20 h-20 rounded-full bg-white border-4 border-gray-300 hover:scale-110 transition-transform"}):e.jsx("button",{onClick:N?H:async()=>{if(E)try{z.current=[];const e=new MediaRecorder(E,{mimeType:"video/webm;codecs=vp9"});e.ondataavailable=e=>{e.data.size>0&&z.current.push(e.data)},e.onstop=()=>{const e=new Blob(z.current,{type:"video/webm"}),t=URL.createObjectURL(e);h(t),d("preview"),O()},e.start(),F.current=e,k(!0),C(0),M.current=setInterval(()=>{C(e=>e>=15?(H(),e):e+1)},1e3)}catch(e){}},className:"w-20 h-20 rounded-full flex items-center justify-center transition-all "+(N?"bg-red-500 hover:bg-red-600":"bg-white hover:scale-110"),children:N?e.jsx(w,{className:"w-8 h-8 text-white"}):e.jsx("div",{className:"w-16 h-16 rounded-full bg-red-500"})}),e.jsx("div",{className:"w-12"})]})]}),"preview"===c&&x&&e.jsxs("div",{className:"relative w-full h-full flex flex-col items-center justify-center bg-black",children:["image"===m?e.jsx("img",{src:x,alt:"Preview",className:"max-w-full max-h-full object-contain",style:{filter:null==(i=xe.find(e=>e.name===f))?void 0:i.css}}):e.jsx("video",{src:x,controls:!0,autoPlay:!0,loop:!0,className:"max-w-full max-h-full object-contain"}),e.jsxs("div",{className:"absolute bottom-8 left-0 right-0 flex justify-center gap-4 px-4",children:[e.jsx("button",{onClick:()=>{h(null),d("select")},className:"px-6 py-3 bg-white/20 text-white rounded-full backdrop-blur-sm hover:bg-white/30 transition-colors font-semibold",children:"Retake"}),e.jsx("button",{onClick:async()=>{if(x&&U){T(!0);try{const e=await fetch(x).then(e=>e.blob()),t="image"===m?"jpg":"webm",s=`${U.id}/${Date.now()}.${t}`,{data:a,error:l}=await J.storage.from("stories").upload(s,e);if(l)throw l;const{data:i}=J.storage.from("stories").getPublicUrl(s),n=new Date;n.setHours(n.getHours()+24);const{error:o}=await J.from("stories").insert({user_id:U.id,media_url:i.publicUrl,media_type:m,duration:"image"===m?5:15,expires_at:n.toISOString()});if(o)throw o;null==r||r(),A()}catch(e){alert("Failed to upload story. Please try again.")}finally{T(!1)}}},disabled:S,className:"px-8 py-3 bg-gradient-to-r from-pink-500 to-purple-500 text-white rounded-full font-bold hover:scale-105 transition-transform disabled:opacity-50 disabled:cursor-not-allowed",children:S?"Uploading...":"Share Story"})]})]})]})})}function fe(){const[t,r]=V.useState([]),[l,i]=V.useState(null),[c,d]=V.useState(0),[m,u]=V.useState(0),[x,h]=V.useState(!1),{user:f}=W(),g=V.useRef(null),p=V.useRef(null);V.useEffect(()=>{b()},[f]),V.useEffect(()=>{if(l&&l.stories[c]){const e=l.stories[c];return v(e.id),j(e.duration),()=>{g.current&&clearInterval(g.current)}}},[l,c]);const b=async()=>{try{const{data:e,error:t}=await J.from("stories").select("*").gt("expires_at",(new Date).toISOString()).order("created_at",{ascending:!1});if(t)throw t;const s=[...new Set((null==e?void 0:e.map(e=>e.user_id))||[])],{data:a}=await J.from("profiles").select("id, username, avatar_url").in("id",s),l=new Map((null==a?void 0:a.map(e=>[e.id,e]))||[]),i=(null==e?void 0:e.map(e=>({...e,profiles:l.get(e.user_id)})))||[];if(f){const e=i.map(e=>e.id),{data:t}=await J.from("story_views").select("story_id").eq("user_id",f.id).in("story_id",e),s=new Set((null==t?void 0:t.map(e=>e.story_id))||[]),a=i.map(e=>({...e,has_viewed:s.has(e.id)})),l={};a.forEach(e=>{var t,s;l[e.user_id]||(l[e.user_id]={user_id:e.user_id,username:(null==(t=e.profiles)?void 0:t.username)||"Unknown",avatar_url:(null==(s=e.profiles)?void 0:s.avatar_url)||null,stories:[],has_unviewed:!1}),l[e.user_id].stories.push(e),e.has_viewed||(l[e.user_id].has_unviewed=!0)}),r(Object.values(l))}else{const e={};i.forEach(t=>{var s,a;e[t.user_id]||(e[t.user_id]={user_id:t.user_id,username:(null==(s=t.profiles)?void 0:s.username)||"Unknown",avatar_url:(null==(a=t.profiles)?void 0:a.avatar_url)||null,stories:[],has_unviewed:!1}),e[t.user_id].stories.push(t)}),r(Object.values(e))}}catch(e){}},j=e=>{u(0),g.current&&clearInterval(g.current);const t=100/(10*e);g.current=setInterval(()=>{u(e=>e>=100?(w(),0):e+t)},100)},v=async e=>{if(f)try{const{error:t}=await J.from("story_views").insert({story_id:e,user_id:f.id});if(!t){const{data:t}=await J.from("stories").select("view_count").eq("id",e).single();t&&await J.from("stories").update({view_count:t.view_count+1}).eq("id",e)}}catch(t){}},w=()=>{if(l)if(c<l.stories.length-1)d(e=>e+1);else{const e=t.findIndex(e=>e.user_id===l.user_id);e<t.length-1?(i(t[e+1]),d(0)):N()}},y=()=>{if(c>0)d(e=>e-1);else{const e=t.findIndex(e=>e.user_id===(null==l?void 0:l.user_id));if(e>0){const s=t[e-1];i(s),d(s.stories.length-1)}}},N=()=>{i(null),d(0),u(0),g.current&&clearInterval(g.current)},k=()=>{h(!0)};return 0===t.length&&f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-4 overflow-x-auto scrollbar-hide",children:[e.jsxs("button",{type:"button",onClick:k,className:"flex flex-col items-center gap-2 min-w-[80px] cursor-pointer hover:opacity-80 transition-opacity",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center border-4 border-white dark:border-gray-800",children:e.jsx(T,{className:"w-8 h-8 text-white"})}),e.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:"Add Story"})]}),e.jsx("div",{className:"flex-1 text-center",children:e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 italic",children:"No stories yet. Be the first to share!"})})]})}),e.jsx(he,{isOpen:x,onClose:()=>h(!1),onSuccess:()=>{h(!1),b()}})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-4 overflow-x-auto scrollbar-hide",children:[f&&e.jsxs("button",{type:"button",onClick:k,className:"flex flex-col items-center gap-2 min-w-[80px] cursor-pointer hover:opacity-80 transition-opacity",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-purple-500 flex items-center justify-center border-4 border-white dark:border-gray-800",children:e.jsx(T,{className:"w-8 h-8 text-white"})}),e.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300",children:"Add Story"})]}),t.map(t=>e.jsxs("button",{onClick:()=>{i(t),d(0)},className:"flex flex-col items-center gap-2 min-w-[80px] cursor-pointer",children:[e.jsx("div",{className:"p-1 rounded-full "+(t.has_unviewed?"bg-gradient-to-br from-pink-500 via-red-500 to-yellow-500":"bg-gray-300 dark:bg-gray-600"),children:t.avatar_url?e.jsx("img",{src:t.avatar_url,alt:t.username,className:"w-14 h-14 rounded-full object-cover border-4 border-white dark:border-gray-800"}):e.jsx("div",{className:"w-14 h-14 rounded-full bg-gray-700 flex items-center justify-center border-4 border-white dark:border-gray-800",children:e.jsx(a,{className:"w-8 h-8 text-white"})})}),e.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 truncate max-w-[80px]",children:t.username})]},t.user_id))]})}),e.jsx(o,{children:l&&e.jsx(n.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-[99999] bg-black",style:{position:"fixed",top:0,left:0,right:0,bottom:0},children:e.jsxs("div",{className:"relative w-full h-full",children:[e.jsxs("div",{className:"absolute top-0 left-0 right-0 z-20 p-4",children:[e.jsx("div",{className:"flex gap-1 mb-4",children:l.stories.map((t,s)=>e.jsxs("div",{className:"flex-1 h-1 bg-white/30 rounded-full overflow-hidden",children:[s===c&&e.jsx("div",{className:"h-full bg-white rounded-full transition-all",style:{width:`${m}%`}}),s<c&&e.jsx("div",{className:"h-full bg-white rounded-full w-full"})]},s))}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[l.avatar_url?e.jsx("img",{src:l.avatar_url,alt:l.username,className:"w-10 h-10 rounded-full object-cover border-2 border-white"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center border-2 border-white",children:e.jsx(a,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-semibold",children:l.username}),e.jsx("p",{className:"text-white/80 text-xs",children:le(new Date(l.stories[c].created_at),{addSuffix:!0})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[f&&l.stories[c].user_id===f.id&&e.jsx("button",{onClick:async()=>{if(!l||!f)return void alert("Error: Not logged in or no story selected");const e=l.stories[c];if(e.user_id===f.id){if(confirm("Are you sure you want to delete this story?"))try{const{data:t,error:s}=await J.from("stories").delete().eq("id",e.id).select();if(s)return void alert(`Failed to delete story: ${s.message}`);const a=l.stories.filter(t=>t.id!==e.id);0===a.length?(N(),b()):(i({...l,stories:a}),c>=a.length&&d(a.length-1),b())}catch(t){alert(`Failed to delete story: ${(null==t?void 0:t.message)||"Unknown error"}`)}}else alert("You can only delete your own stories")},className:"text-white p-2 hover:bg-red-500/50 rounded-full transition-colors",title:"Delete story",children:e.jsx(E,{className:"w-5 h-5"})}),e.jsx("button",{onClick:N,className:"text-white p-2 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(s,{className:"w-6 h-6"})})]})]})]}),e.jsx("button",{onClick:y,className:"absolute left-4 top-1/2 transform -translate-y-1/2 z-10 bg-black/50 p-3 rounded-full hover:bg-black/70 transition-colors",children:e.jsx(R,{className:"w-6 h-6 text-white"})}),e.jsx("button",{onClick:w,className:"absolute right-4 top-1/2 transform -translate-y-1/2 z-10 bg-black/50 p-3 rounded-full hover:bg-black/70 transition-colors",children:e.jsx(I,{className:"w-6 h-6 text-white"})}),"image"===l.stories[c].media_type?e.jsx("img",{src:l.stories[c].media_url,alt:"Story",className:"w-full h-full object-contain"}):e.jsx("video",{ref:p,src:l.stories[c].media_url,className:"w-full h-full object-contain",autoPlay:!0,muted:!0,playsInline:!0}),e.jsx("div",{className:"absolute inset-0 flex",onClick:e=>{const t=e.currentTarget.getBoundingClientRect();e.clientX-t.left<t.width/2?y():w()}})]})})}),e.jsx(he,{isOpen:x,onClose:()=>h(!1),onSuccess:()=>{h(!1),b()}})]})}function ge(){var t,s;const[r,l]=V.useState([]),[i,c]=V.useState(0),[d,u]=V.useState(!0),[x,h]=V.useState(!1),[f,g]=V.useState(!0),[p,b]=V.useState(!1),v=V.useRef({}),w=V.useRef(null),{user:y}=W(),N=ie(),k=V.useRef(0),_=V.useRef(0);V.useEffect(()=>{C()},[]),V.useEffect(()=>{Object.entries(v.current).forEach(([e,t])=>{t&&(parseInt(e)===i&&f?t.play():t.pause())})},[i,f]);const C=async()=>{try{const{data:e,error:t}=await J.from("video_reels").select("\n          *,\n          profiles!video_reels_user_id_fkey (username, avatar_url)\n        ").order("created_at",{ascending:!1}).limit(20);if(t)throw t;if(y){const t=e.map(e=>e.id),{data:s}=await J.from("video_reel_likes").select("reel_id").eq("user_id",y.id).in("reel_id",t),a=new Set((null==s?void 0:s.map(e=>e.reel_id))||[]);l(e.map(e=>({...e,is_liked:a.has(e.id)})))}else l(e||[])}catch(e){}finally{u(!1)}};if(d)return e.jsx("div",{className:"fixed inset-0 bg-black flex items-center justify-center",children:e.jsx("div",{className:"text-white text-lg",children:"Loading reels..."})});if(0===r.length)return e.jsx("div",{className:"fixed inset-0 bg-black flex items-center justify-center",children:e.jsxs("div",{className:"text-white text-center px-6",children:[e.jsx(j,{className:"w-16 h-16 mx-auto mb-4 opacity-50"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"No Reels Yet"}),e.jsx("p",{className:"text-gray-400",children:"Be the first to post a racing reel!"})]})});const S=r[i];return e.jsx("div",{ref:w,className:"fixed inset-0 bg-black overflow-hidden",onTouchStart:e=>{k.current=e.touches[0].clientY},onTouchMove:e=>{_.current=e.touches[0].clientY},onTouchEnd:()=>{const e=k.current-_.current;Math.abs(e)>50&&(e>0&&i<r.length-1?c(e=>e+1):e<0&&i>0&&c(e=>e-1))},children:e.jsx(o,{mode:"wait",children:e.jsxs(n.div,{initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},transition:{duration:.3},className:"relative w-full h-full",children:[e.jsx("video",{ref:e=>v.current[i]=e,src:S.video_url,className:"absolute inset-0 w-full h-full object-cover",loop:!0,playsInline:!0,muted:x,onClick:()=>g(!f)}),!f&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"bg-black/50 rounded-full p-6",children:e.jsx(j,{className:"w-16 h-16 text-white",fill:"white"})})}),e.jsxs("div",{className:"absolute top-4 left-4 right-4 flex items-center justify-between z-10",children:[e.jsx("button",{onClick:()=>N(-1),className:"text-white text-sm font-semibold bg-black/30 px-4 py-2 rounded-full backdrop-blur-sm",children:"Back"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>h(!x),className:"bg-black/30 p-2 rounded-full backdrop-blur-sm",children:x?e.jsx(P,{className:"w-6 h-6 text-white"}):e.jsx($,{className:"w-6 h-6 text-white"})})})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 p-6 bg-gradient-to-t from-black/80 via-black/40 to-transparent",children:e.jsxs("div",{className:"flex items-end justify-between",children:[e.jsxs("div",{className:"flex-1 mr-4",children:[e.jsx("div",{className:"flex items-center gap-3 mb-3",children:e.jsxs("button",{onClick:()=>N(`/profile/${S.user_id}`),className:"flex items-center gap-2",children:[(null==(t=S.profiles)?void 0:t.avatar_url)?e.jsx("img",{src:S.profiles.avatar_url,alt:S.profiles.username,className:"w-10 h-10 rounded-full object-cover border-2 border-white"}):e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center border-2 border-white",children:e.jsx(a,{className:"w-6 h-6 text-white"})}),e.jsx("span",{className:"text-white font-semibold",children:(null==(s=S.profiles)?void 0:s.username)||"Unknown"})]})}),S.title&&e.jsx("h3",{className:"text-white font-bold text-lg mb-1",children:S.title}),S.description&&e.jsx("p",{className:"text-white/90 text-sm mb-2 line-clamp-2",children:S.description}),S.hashtags&&S.hashtags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:S.hashtags.map((t,s)=>e.jsxs("span",{className:"text-blue-400 text-sm font-medium",children:["#",t]},s))})]}),e.jsxs("div",{className:"flex flex-col items-center gap-6",children:[e.jsxs("button",{onClick:()=>(async e=>{if(!y)return;const t=r.find(t=>t.id===e);if(t)try{t.is_liked?(await J.from("video_reel_likes").delete().eq("reel_id",e).eq("user_id",y.id),await J.rpc("decrement_reel_likes",{reel_id:e})):(await J.from("video_reel_likes").insert({reel_id:e,user_id:y.id}),await J.rpc("increment_reel_likes",{reel_id:e})),l(r.map(t=>t.id===e?{...t,is_liked:!t.is_liked,like_count:t.like_count+(t.is_liked?-1:1)}:t))}catch(s){}})(S.id),className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"p-3 rounded-full "+(S.is_liked?"bg-red-500":"bg-black/30 backdrop-blur-sm"),children:e.jsx(m,{className:"w-7 h-7 "+(S.is_liked?"text-white fill-white":"text-white")})}),e.jsx("span",{className:"text-white text-xs font-semibold",children:S.like_count})]}),e.jsxs("button",{onClick:()=>b(!0),className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"bg-black/30 p-3 rounded-full backdrop-blur-sm",children:e.jsx(q,{className:"w-7 h-7 text-white"})}),e.jsx("span",{className:"text-white text-xs font-semibold",children:S.comment_count})]}),e.jsxs("button",{onClick:()=>(async e=>{try{navigator.share&&(await navigator.share({title:e.title||"Check out this racing video!",text:e.description||"",url:window.location.href}),await J.rpc("increment_reel_shares",{reel_id:e.id}))}catch(t){}})(S),className:"flex flex-col items-center gap-1",children:[e.jsx("div",{className:"bg-black/30 p-3 rounded-full backdrop-blur-sm",children:e.jsx(F,{className:"w-7 h-7 text-white"})}),e.jsx("span",{className:"text-white text-xs font-semibold",children:S.share_count})]})]})]})}),e.jsx("div",{className:"absolute right-4 top-1/2 transform -translate-y-1/2 flex flex-col gap-2",children:r.map((t,s)=>e.jsx("div",{className:"w-2 h-2 rounded-full transition-all "+(s===i?"bg-white w-2 h-8":"bg-white/50")},s))})]},i)})})}function pe(){var l;const[i,d]=V.useState(!1),[u,x]=V.useState(null),[h,g]=V.useState({}),[p,b]=V.useState({}),[v,w]=V.useState(null),[N,k]=V.useState(null),[_,C]=V.useState(null),[S,T]=V.useState("all"),[E,R]=V.useState(null),[I,P]=V.useState(new Set),[$,q]=V.useState("all"),[X,K]=V.useState(null),[Q,Z]=V.useState(new Set),[xe,he]=V.useState(null),[pe,be]=V.useState(1),[je,ve]=V.useState(!0),[we,ye]=V.useState(!1),[Ne,ke]=V.useState(!1),_e=V.useRef(null),Ce=V.useRef(null),{user:Se}=W(),Te=ie(),{posts:Ee,loading:Re,loadPosts:Ie,toggleReaction:Pe,addComment:$e,deletePost:qe,toggleBookmark:Fe,bookmarks:ze,toggleCommentReaction:Me,commentReactions:Ue,trackPostView:De,incrementShareCount:Oe}=ne();V.useEffect(()=>{Se&&(ke(!0),be(1),ve(!0),Ie({filter:S,mediaType:$,page:1}).finally(()=>{ke(!1),Ce.current&&Ce.current.scrollTo({top:0,behavior:"smooth"})}))},[Se,S,$]),V.useEffect(()=>{const e=new IntersectionObserver(e=>{if(e[0].isIntersecting&&je&&!Re&&!Ne){const e=pe+1;be(e),Ie({filter:S,mediaType:$,page:e}).then(e=>{e&&0!==e.length||ve(!1)})}},{threshold:.5,rootMargin:"200px"}),t=_e.current;return t&&e.observe(t),()=>{t&&e.unobserve(t)}},[pe,je,Re,S,$]),V.useEffect(()=>{const e=()=>{Ee.forEach(e=>{const t=document.getElementById(`post-${e.id}`);if(t){const s=t.getBoundingClientRect();s.top>=0&&s.bottom<=window.innerHeight&&De(e.id)}})};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[Ee,De]),V.useEffect(()=>{if(!Se)return;const e=J.channel("community_updates").on("postgres_changes",{event:"INSERT",schema:"public",table:"posts"},e=>{Ie({filter:S,mediaType:$,page:1})}).on("postgres_changes",{event:"INSERT",schema:"public",table:"post_comments"},e=>{Ie({filter:S,mediaType:$,page:1})}).on("postgres_changes",{event:"INSERT",schema:"public",table:"post_likes"},e=>{Ie({filter:S,mediaType:$,page:1})}).subscribe();return()=>{J.removeChannel(e)}},[Se,S,$]);const He=async e=>{const t=h[e]||"",s=p[e];if(!t.trim()&&!s)return;let a=t.trim();s&&(a=a?`${a} [GIF]${s}[/GIF]`:`[GIF]${s}[/GIF]`);const r=(null==X?void 0:X.postId)===e?X.commentId:void 0;await $e(e,a,r)&&(g(t=>({...t,[e]:""})),b(t=>({...t,[e]:null})),K(null))},Le=t=>{const s=/\[GIF\](.*?)\[\/GIF\]/g,a=[];let r,l=0;for(;null!==(r=s.exec(t));){if(r.index>l){const s=t.slice(l,r.index);a.push(e.jsx("span",{children:Ae(s)},l))}a.push(e.jsx("img",{src:r[1],alt:"GIF",className:"max-w-full rounded-xl mt-2",style:{maxHeight:"200px"}},r.index)),l=r.index+r[0].length}if(l<t.length){const s=t.slice(l);a.push(e.jsx("span",{children:Ae(s)},l))}return a.length>0?a:Ae(t)},Ae=t=>{const s=/@(\w+)/g,a=/#(\w+)/g,r=/(https?:\/\/[^\s]+)/g,l=[];let i=0;const n=[];let o;for(;null!==(o=s.exec(t));)n.push({index:o.index,text:o[0],type:"mention"});for(;null!==(o=a.exec(t));)n.push({index:o.index,text:o[0],type:"hashtag"});for(;null!==(o=r.exec(t));)n.push({index:o.index,text:o[0],type:"url"});return n.sort((e,t)=>e.index-t.index),n.forEach((s,a)=>{if(s.index>i&&l.push(t.slice(i,s.index)),"mention"===s.type){const t=s.text.substring(1);l.push(e.jsx("span",{className:"text-brand-gold font-semibold cursor-pointer hover:underline",onClick:()=>Te(`/user/${t}`),children:s.text},`mention-${a}`))}else"hashtag"===s.type?l.push(e.jsx("span",{className:"text-blue-500 font-semibold cursor-pointer hover:underline",children:s.text},`hashtag-${a}`)):"url"===s.type&&l.push(e.jsx("a",{href:s.text,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",onClick:e=>e.stopPropagation(),children:s.text},`url-${a}`));i=s.index+s.text.length}),i<t.length&&l.push(t.slice(i)),l.length>0?l:t},Be=e=>{try{const t=new Date(e),s=new Date,a=Math.abs(s.getTime()-t.getTime())/36e5;return a<24?le(t,{addSuffix:!0}):a<48?"Yesterday":oe(t,"MMM d")}catch{return""}};return Se?e.jsxs("div",{ref:Ce,className:"min-h-screen bg-gradient-to-b from-gray-50 to-gray-100 dark:from-gray-900 dark:to-black pb-20 overflow-y-auto",children:[e.jsxs("div",{className:"sticky top-0 z-50 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 shadow-sm",children:[e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 py-3",children:e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("img",{src:"/android-icon-192-192.png",alt:"PIT-BOX.COM",className:"w-10 h-10 sm:w-12 sm:h-12 object-contain flex-shrink-0"}),e.jsx(y,{className:"w-5 h-5 sm:w-6 sm:h-6 text-brand-gold flex-shrink-0"}),e.jsx("h1",{className:"text-lg sm:text-xl font-bold bg-gradient-to-r from-brand-gold to-amber-600 bg-clip-text text-transparent",children:"Pit Community"})]})})}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800/50",children:e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-4 py-2",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 sm:gap-3",children:[e.jsx(me,{}),e.jsx(de,{}),e.jsx(ce,{})]})})})]}),e.jsx(ue,{activeTab:S,onTabChange:T,mediaTypeFilter:$,onMediaTypeFilterChange:q}),e.jsx(fe,{}),e.jsxs("div",{className:"max-w-2xl mx-auto px-4 pt-6",children:[e.jsxs(n.button,{onClick:()=>ye(!0),className:"w-full mb-4 p-4 glass-panel flex items-center justify-center gap-3 group hover:shadow-xl transition-all duration-300 bg-gradient-to-r from-purple-500 to-pink-500 text-white border-none",whileHover:{scale:1.02},whileTap:{scale:.98},children:[e.jsx(z,{className:"w-6 h-6"}),e.jsx("span",{className:"font-bold text-lg",children:"Watch Racing Reels"}),e.jsx(j,{className:"w-5 h-5"})]}),e.jsxs(n.button,{onClick:()=>d(!0),className:"w-full mb-6 p-6 glass-panel flex items-center gap-4 group hover:shadow-xl transition-all duration-300",whileHover:{scale:1.01},whileTap:{scale:.99},children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-brand-gold to-amber-600 flex items-center justify-center overflow-hidden",children:(null==(l=Se.user_metadata)?void 0:l.avatar_url)?e.jsx("img",{src:Se.user_metadata.avatar_url,alt:"You",className:"w-full h-full object-cover"}):e.jsx(a,{className:"w-6 h-6 text-white"})}),e.jsx("span",{className:"flex-1 text-left text-gray-500 dark:text-gray-400 group-hover:text-brand-gold transition-colors",children:"Share your racing story..."}),e.jsx(y,{className:"w-5 h-5 text-brand-gold"})]}),e.jsx(ee,{variant:"inline",dismissible:!0,showDelay:5e3}),Ne&&Ee.length>0&&e.jsx(n.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-40 bg-black/20 backdrop-blur-sm flex items-center justify-center pointer-events-none",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-full p-4 shadow-2xl",children:e.jsx(M,{className:"w-8 h-8 animate-spin text-brand-gold"})})}),Re&&0===Ee.length?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(M,{className:"w-8 h-8 animate-spin text-brand-gold"})}):e.jsx(o,{mode:"popLayout",children:Ee.map((l,i)=>{var j,y,N,S,T,E,$,q,z;return e.jsx(n.div,{layout:!0,initial:{opacity:0,y:50},animate:{opacity:1,y:0},exit:{opacity:0,scale:.9},transition:{duration:.4,delay:.05*i},className:"mb-8",children:e.jsxs("div",{className:"glass-panel hover:shadow-2xl transition-all duration-300 rounded-xl",children:[e.jsxs("div",{className:"p-6 pb-0",id:`post-${l.id}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer group",onClick:()=>{var e;return Te(`/user/${null==(e=l.profiles)?void 0:e.id}`)},children:[e.jsx("div",{className:"relative",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-brand-gold to-amber-600 p-0.5",children:e.jsx("div",{className:"w-full h-full rounded-full bg-white dark:bg-gray-900 flex items-center justify-center overflow-hidden",children:(null==(j=l.profiles)?void 0:j.avatar_url)?e.jsx("img",{src:l.profiles.avatar_url,alt:l.profiles.username,className:"w-full h-full object-cover"}):e.jsx(a,{className:"w-6 h-6 text-brand-gold"})})})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold group-hover:text-brand-gold transition-colors",children:(null==(y=l.profiles)?void 0:y.full_name)||(null==(N=l.profiles)?void 0:N.username)}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[e.jsx(r,{className:"w-3 h-3"}),Be(l.created_at),l.location&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"â€¢"}),e.jsx(U,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate max-w-[150px]",children:l.location})]})]})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>C(_===l.id?null:l.id),className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",children:e.jsx(D,{className:"w-5 h-5"})}),_===l.id&&e.jsxs(n.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"absolute right-0 mt-2 w-48 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden z-10",children:[(null==Se?void 0:Se.id)===l.user_id&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>{R(l),d(!0),C(null)},className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2",children:[e.jsx(O,{className:"w-4 h-4"}),"Edit Post"]}),e.jsx("button",{onClick:()=>{k(l.id),C(null)},className:"w-full px-4 py-3 text-left text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",children:"Delete Post"})]}),e.jsx("button",{onClick:()=>{Fe(l.id),C(null)},className:"w-full px-4 py-3 text-left hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors flex items-center gap-2",children:ze.includes(l.id)?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-4 h-4"}),"Unsave"]}):e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-4 h-4"}),"Save"]})})]})]})]}),l.content&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-base leading-relaxed whitespace-pre-wrap",children:Ae(l.content)}),l.is_edited&&e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 italic",children:"Edited"})]})]}),l.image_url&&e.jsxs("div",{className:"relative group cursor-pointer overflow-hidden",onClick:()=>he(l.image_url),children:[e.jsx("img",{src:l.image_url,alt:"Post",className:"w-full max-h-[600px] object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:e.jsx(L,{className:"w-12 h-12 text-white opacity-0 group-hover:opacity-100 transition-opacity"})})]}),l.video_url&&e.jsx("div",{className:"relative bg-black overflow-hidden",children:e.jsx(te,{url:l.video_url,width:"100%",height:"auto",controls:!0,style:{maxHeight:"600px"}})}),e.jsxs("div",{className:"p-6",children:[(l.view_count>0||l.share_count>0)&&e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 dark:text-gray-400 mb-4",children:[l.view_count>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"w-3 h-3"}),l.view_count," ",1===l.view_count?"view":"views"]}),l.share_count>0&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"w-3 h-3"}),l.share_count," ",1===l.share_count?"share":"shares"]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs(n.button,{onClick:()=>(async e=>{P(t=>new Set(t).add(e)),setTimeout(()=>{P(t=>{const s=new Set(t);return s.delete(e),s})},600),await Pe(e,"like")})(l.id),className:"flex items-center gap-2 group",whileTap:{scale:.9},children:[e.jsx(n.div,{animate:I.has(l.id)?{scale:[1,1.3,1]}:{},transition:{duration:.3},children:e.jsx(m,{className:"w-6 h-6 transition-colors "+((null==(S=l.post_reactions)?void 0:S.some(e=>e.user_id===Se.id))?"fill-red-500 text-red-500":"text-gray-600 dark:text-gray-400 group-hover:text-red-500")})}),e.jsx("span",{className:"font-semibold text-sm",children:(null==(T=l.post_reactions)?void 0:T.length)||0})]}),e.jsxs(n.button,{onClick:()=>x(u===l.id?null:l.id),className:"flex items-center gap-2 group",whileTap:{scale:.9},children:[e.jsx(t,{className:"w-6 h-6 text-gray-600 dark:text-gray-400 group-hover:text-brand-gold transition-colors"}),e.jsx("span",{className:"font-semibold text-sm",children:(null==(E=l.post_comments)?void 0:E.length)||0})]}),e.jsx(n.button,{onClick:()=>(async e=>{const t=`${window.location.origin}/community/post/${e.id}`;try{await Oe(e.id),navigator.share?await navigator.share({title:"Pit Community",text:e.content||"Check out this post!",url:t}):(await navigator.clipboard.writeText(t),w(e.id),setTimeout(()=>w(null),2e3))}catch(s){}})(l),className:"flex items-center gap-2 group",whileTap:{scale:.9},children:v===l.id?e.jsx(c,{className:"w-6 h-6 text-green-500"}):e.jsx(F,{className:"w-6 h-6 text-gray-600 dark:text-gray-400 group-hover:text-brand-gold transition-colors"})})]}),e.jsx("button",{onClick:()=>Fe(l.id),className:"group",children:ze.includes(l.id)?e.jsx(H,{className:"w-6 h-6 text-brand-gold fill-current"}):e.jsx(f,{className:"w-6 h-6 text-gray-600 dark:text-gray-400 group-hover:text-brand-gold transition-colors"})})]}),e.jsx(o,{children:u===l.id&&e.jsxs(n.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.3},className:"border-t border-gray-200 dark:border-gray-700 pt-6 space-y-4 relative",children:[e.jsxs("div",{className:"flex gap-3 items-start",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-brand-gold to-amber-600 flex-shrink-0 flex items-center justify-center overflow-hidden",children:(null==($=Se.user_metadata)?void 0:$.avatar_url)?e.jsx("img",{src:Se.user_metadata.avatar_url,alt:"You",className:"w-full h-full object-cover"}):e.jsx(a,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[(null==X?void 0:X.postId)===l.id&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-800 px-3 py-2 rounded-lg",children:[e.jsx(B,{className:"w-3 h-3"}),"Replying to @",X.username,e.jsx("button",{onClick:()=>K(null),className:"ml-auto text-red-500 hover:text-red-600",children:e.jsx(s,{className:"w-4 h-4"})})]}),p[l.id]&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:p[l.id],alt:"Selected GIF",className:"max-w-xs rounded-xl",style:{maxHeight:"150px"}}),e.jsx("button",{onClick:()=>b(e=>({...e,[l.id]:null})),className:"absolute -top-2 -right-2 p-1 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:e.jsx(s,{className:"w-4 h-4"})})]}),e.jsx("input",{type:"text",value:h[l.id]||"",onChange:e=>g(t=>({...t,[l.id]:e.target.value})),placeholder:"Add a comment...",className:"w-full px-4 py-3 rounded-full bg-gray-100 dark:bg-gray-800 border-2 border-transparent focus:border-brand-gold transition-all",onKeyPress:e=>{"Enter"===e.key&&He(l.id)}}),e.jsxs("div",{className:"flex items-center gap-2 pl-2",children:[e.jsx("div",{className:"relative",children:e.jsx(se,{onGifSelect:e=>b(t=>({...t,[l.id]:e}))})}),e.jsx("div",{className:"relative",children:e.jsx(ae,{onEmojiSelect:e=>g(t=>({...t,[l.id]:(t[l.id]||"")+e})),theme:document.documentElement.classList.contains("dark")?"dark":"light"})}),e.jsx("button",{onClick:()=>He(l.id),disabled:!(null==(q=h[l.id])?void 0:q.trim())&&!p[l.id],className:"ml-auto px-6 py-2 bg-brand-gold text-white rounded-full font-semibold hover:bg-amber-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Post"})]})]})]}),e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:null==(z=l.post_comments)?void 0:z.filter(e=>!e.parent_comment_id).map(t=>{var s,r,i,o;return e.jsxs(n.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-gray-300 to-gray-400 dark:from-gray-700 dark:to-gray-600 flex-shrink-0 flex items-center justify-center overflow-hidden cursor-pointer",onClick:()=>{var e;return Te(`/user/${null==(e=t.profiles)?void 0:e.id}`)},children:(null==(s=t.profiles)?void 0:s.avatar_url)?e.jsx("img",{src:t.profiles.avatar_url,alt:t.profiles.username,className:"w-full h-full object-cover"}):e.jsx(a,{className:"w-5 h-5 text-gray-600 dark:text-gray-300"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-2xl px-4 py-3",children:[e.jsx("p",{className:"font-semibold text-sm mb-1 cursor-pointer hover:underline",onClick:()=>{var e;return Te(`/user/${null==(e=t.profiles)?void 0:e.id}`)},children:(null==(r=t.profiles)?void 0:r.full_name)||(null==(i=t.profiles)?void 0:i.username)}),e.jsx("div",{className:"text-sm",children:Le(t.content)})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 dark:text-gray-400 mt-1 ml-4",children:[e.jsx("span",{children:Be(t.created_at)}),e.jsxs("button",{onClick:()=>Me(t.id),className:"flex items-center gap-1 hover:text-brand-gold transition-colors "+(Ue[t.id]?"text-brand-gold font-semibold":""),children:[e.jsx(m,{className:"w-3 h-3 "+(Ue[t.id]?"fill-current":"")}),t.reaction_count>0&&t.reaction_count]}),e.jsxs("button",{onClick:()=>{var e;return K({postId:l.id,commentId:t.id,username:(null==(e=t.profiles)?void 0:e.username)||""})},className:"hover:text-brand-gold transition-colors flex items-center gap-1",children:[e.jsx(B,{className:"w-3 h-3"}),"Reply"]}),t.reply_count>0&&e.jsxs("button",{onClick:()=>{const e=new Set(Q);e.has(t.id)?e.delete(t.id):e.add(t.id),Z(e)},className:"hover:text-brand-gold transition-colors flex items-center gap-1",children:[Q.has(t.id)?e.jsx(G,{className:"w-3 h-3"}):e.jsx(Y,{className:"w-3 h-3"}),t.reply_count," ",1===t.reply_count?"reply":"replies"]})]})]})]}),Q.has(t.id)&&e.jsx("div",{className:"ml-12 space-y-3",children:null==(o=l.post_comments)?void 0:o.filter(e=>e.parent_comment_id===t.id).map(t=>{var s,r,l;return e.jsxs(n.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-gray-300 to-gray-400 dark:from-gray-700 dark:to-gray-600 flex-shrink-0 flex items-center justify-center overflow-hidden cursor-pointer",onClick:()=>{var e;return Te(`/user/${null==(e=t.profiles)?void 0:e.id}`)},children:(null==(s=t.profiles)?void 0:s.avatar_url)?e.jsx("img",{src:t.profiles.avatar_url,alt:t.profiles.username,className:"w-full h-full object-cover"}):e.jsx(a,{className:"w-4 h-4 text-gray-600 dark:text-gray-300"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-2xl px-3 py-2",children:[e.jsx("p",{className:"font-semibold text-xs mb-1 cursor-pointer hover:underline",onClick:()=>{var e;return Te(`/user/${null==(e=t.profiles)?void 0:e.id}`)},children:(null==(r=t.profiles)?void 0:r.full_name)||(null==(l=t.profiles)?void 0:l.username)}),e.jsx("div",{className:"text-xs",children:Le(t.content)})]}),e.jsxs("div",{className:"flex items-center gap-4 text-xs text-gray-500 dark:text-gray-400 mt-1 ml-3",children:[e.jsx("span",{children:Be(t.created_at)}),e.jsxs("button",{onClick:()=>Me(t.id),className:"flex items-center gap-1 hover:text-brand-gold transition-colors "+(Ue[t.id]?"text-brand-gold font-semibold":""),children:[e.jsx(m,{className:"w-3 h-3 "+(Ue[t.id]?"fill-current":"")}),t.reaction_count>0&&t.reaction_count]})]})]})]},t.id)})})]},t.id)})}),l.post_comments&&l.post_comments.length>3&&e.jsxs("button",{onClick:()=>Te(`/community/post/${l.id}`),className:"w-full text-center text-sm text-brand-gold hover:underline py-2",children:["View all ",l.post_comments.length," comments"]})]})})]})]})},l.id)})}),0===Ee.length&&!Re&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(n.div,{initial:{scale:0},animate:{scale:1},className:"w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-brand-gold to-amber-600 flex items-center justify-center",children:e.jsx(y,{className:"w-10 h-10 text-white"})}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"No posts yet"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Be the first to share something amazing!"}),e.jsx("button",{onClick:()=>d(!0),className:"btn-primary",children:"Create Post"})]}),je&&Ee.length>0&&e.jsx("div",{ref:_e,className:"flex justify-center py-8",children:e.jsx(M,{className:"w-8 h-8 animate-spin text-brand-gold"})}),!je&&Ee.length>0&&e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:e.jsx("p",{children:"You've reached the end"})})]}),e.jsx(re,{isOpen:i,onClose:()=>{d(!1),R(null)},post:E||void 0,onSuccess:()=>{Ie({filter:S,mediaType:$})}}),N&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm",children:e.jsxs(n.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white dark:bg-gray-800 rounded-2xl p-6 max-w-md w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Delete Post?"}),e.jsx("p",{className:"mb-6 text-gray-600 dark:text-gray-400",children:"This action cannot be undone."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>k(null),className:"flex-1 px-4 py-3 bg-gray-100 dark:bg-gray-700 rounded-xl font-semibold hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:"Cancel"}),e.jsx("button",{onClick:()=>(async e=>{await qe(e)&&k(null)})(N),className:"flex-1 px-4 py-3 bg-red-500 text-white rounded-xl font-semibold hover:bg-red-600 transition-colors",children:"Delete"})]})]})}),xe&&e.jsxs(n.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>he(null),className:"fixed inset-0 z-50 bg-black/95 backdrop-blur-sm flex items-center justify-center p-4",children:[e.jsx("button",{onClick:()=>he(null),className:"absolute top-4 right-4 p-2 bg-white/10 hover:bg-white/20 rounded-full transition-colors",children:e.jsx(s,{className:"w-6 h-6 text-white"})}),e.jsx(n.img,{initial:{scale:.8},animate:{scale:1},src:xe,alt:"Full size",className:"max-w-full max-h-full object-contain rounded-lg",onClick:e=>e.stopPropagation()})]}),we&&e.jsxs("div",{className:"fixed inset-0 z-[9999]",children:[e.jsx(ge,{}),e.jsx("button",{onClick:()=>ye(!1),className:"absolute left-4 z-[10000] bg-black/50 text-white px-4 py-2 rounded-full backdrop-blur-sm hover:bg-black/70 transition-colors",style:{top:"max(env(safe-area-inset-top, 0px) + 1rem, 1rem)"},children:"Close Reels"})]})]}):e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Welcome to Pit Community"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"Sign in to connect with racers worldwide"})]})})}export{pe as default};

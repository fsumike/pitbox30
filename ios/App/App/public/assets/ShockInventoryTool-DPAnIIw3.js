import{j as e,V as s,ae as t,$ as a,ak as r,aF as l,a0 as o,Q as n,X as i}from"./ui-v2ReSvUE.js";import{r as d}from"./react-YWE4JMTy.js";import{u as c}from"./useShocks-C1UvY-iB.js";import{C as u,h,j as x,k as g}from"./index-Cgc97SP_.js";import"./router-BNBI7_bc.js";import"./supabase-Du4GZSDg.js";function m(){const{shocks:m,loading:b,addShock:f,updateShock:y,deleteShock:p,getSignedUrlForShock:j}=c(),[N,v]=d.useState(""),[w,k]=d.useState(!1),[_,S]=d.useState(!1),[C,D]=d.useState(!1),[F,L]=d.useState(null),[A,P]=d.useState({serial_number:"",notes:"",last_refurbished:""}),[T,U]=d.useState(null),[R,$]=d.useState(null),[E,z]=d.useState(!1),[B,I]=d.useState(null),[O,V]=d.useState(new Set),q=d.useRef(null),G=m.filter(e=>e.serial_number.toLowerCase().includes(N.toLowerCase())),Q=async()=>{var e;try{if(u.isNativePlatform()){const e=await h.getPhoto({quality:90,resultType:g.DataUrl,source:x.Camera,saveToGallery:!1,allowEditing:!1});if(e.dataUrl){const s=await fetch(e.dataUrl),t=await s.blob(),a=new File([t],`dyno-${Date.now()}.jpg`,{type:"image/jpeg"});U(a),$(e.dataUrl)}}else null==(e=q.current)||e.click()}catch(s){alert("Failed to take photo. Please try again.")}},H=e=>{var s;const t=null==(s=e.target.files)?void 0:s[0];if(t){U(t);const e=new FileReader;e.onloadend=()=>{$(e.result)},e.readAsDataURL(t)}},J=()=>{P({serial_number:"",notes:"",last_refurbished:""}),U(null),$(null),L(null),I(null)},K=()=>{U(null),$(null)};return b?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Shock Inventory"}),e.jsxs("button",{onClick:()=>k(!0),className:"flex items-center gap-2 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors",children:[e.jsx(s,{className:"w-5 h-5"}),"Add Shock"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(t,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search by serial number...",value:N,onChange:e=>v(e.target.value),className:"w-full pl-10 pr-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),0===G.length?e.jsxs("div",{className:"text-center py-12 bg-gray-800 rounded-lg border border-gray-700",children:[e.jsx(a,{className:"w-12 h-12 text-gray-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-400",children:N?"No shocks found":"No shocks in inventory. Add your first shock!"})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:G.map(s=>e.jsxs("div",{className:"bg-gray-800 border border-gray-700 rounded-lg p-4 hover:border-orange-500 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-bold text-white mb-1",children:s.serial_number}),s.last_refurbished&&e.jsxs("p",{className:"text-sm text-gray-400 flex items-center gap-1",children:[e.jsx(r,{className:"w-4 h-4"}),"Refurbished: ",new Date(s.last_refurbished).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>(e=>{L(e),P({serial_number:e.serial_number,notes:e.notes||"",last_refurbished:e.last_refurbished?new Date(e.last_refurbished).toISOString().split("T")[0]:""}),U(null),$(e.dyno_photo_url),S(!0)})(s),className:"p-2 text-gray-400 hover:text-orange-500 transition-colors",children:e.jsx(l,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>(async e=>{if(confirm(`Delete shock ${e.serial_number}? This cannot be undone.`))try{await p(e.id)}catch(s){alert(s instanceof Error?s.message:"Failed to delete shock")}})(s),className:"p-2 text-gray-400 hover:text-red-500 transition-colors",children:e.jsx(o,{className:"w-4 h-4"})})]})]}),s.dyno_photo_url?e.jsxs("div",{onClick:()=>(e=>{L(e),D(!0)})(s),className:"relative aspect-video bg-gray-900 rounded-lg overflow-hidden cursor-pointer group",children:[e.jsx("img",{src:s.dyno_photo_url,alt:`Dyno sheet for ${s.serial_number}`,className:"w-full h-full object-cover group-hover:opacity-80 transition-opacity",onLoad:()=>{},onError:e=>(async(e,s)=>{if(!O.has(e.id)){V(s=>new Set(s).add(e.id));try{const t=await j(e);t&&t!==e.dyno_photo_url&&(s.src=t,setTimeout(()=>{V(s=>{const t=new Set(s);return t.delete(e.id),t})},1e3))}catch(t){}}})(s,e.currentTarget),loading:"lazy"},`${s.id}-${s.dyno_photo_url}`),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx("span",{className:"bg-black/50 px-4 py-2 rounded-lg text-white text-sm",children:"View Full Size"})})]}):e.jsx("div",{className:"aspect-video bg-gray-900 rounded-lg flex items-center justify-center",children:e.jsx(n,{className:"w-8 h-8 text-gray-600"})}),s.notes&&e.jsx("p",{className:"mt-3 text-sm text-gray-400 line-clamp-2",children:s.notes})]},s.id))}),w&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-gray-900 rounded-lg max-w-lg w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Add New Shock"}),e.jsx("button",{onClick:()=>{k(!1),J()},className:"text-gray-400 hover:text-white",children:e.jsx(i,{className:"w-6 h-6"})})]}),B&&e.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500 rounded-lg text-red-200 text-sm",children:B}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Serial Number *"}),e.jsx("input",{type:"text",value:A.serial_number,onChange:e=>P({...A,serial_number:e.target.value}),placeholder:"e.g., 1234, ABCD, 12AB...",className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Dyno Sheet Photo"}),R?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:R,alt:"Dyno sheet preview",className:"w-full rounded-lg"}),e.jsx("button",{onClick:K,className:"absolute top-2 right-2 p-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:e.jsx(i,{className:"w-4 h-4"})})]}):e.jsxs("button",{onClick:Q,className:"w-full py-8 border-2 border-dashed border-gray-700 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-orange-500 transition-colors",children:[e.jsx(a,{className:"w-8 h-8 text-gray-400"}),e.jsx("span",{className:"text-gray-400",children:"Take/Upload Photo"})]}),e.jsx("input",{ref:q,type:"file",accept:"image/*",onChange:H,className:"hidden"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Last Refurbished"}),e.jsx("input",{type:"date",value:A.last_refurbished,onChange:e=>P({...A,last_refurbished:e.target.value}),className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Notes"}),e.jsx("textarea",{value:A.notes,onChange:e=>P({...A,notes:e.target.value}),placeholder:"Optional notes about this shock...",rows:3,className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>{k(!1),J()},className:"flex-1 px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition-colors",disabled:E,children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(A.serial_number.trim())try{z(!0),I(null),await f(A.serial_number,T||void 0,A.notes||void 0,A.last_refurbished||void 0),J(),k(!1)}catch(e){const s=e instanceof Error?e.message:"Failed to add shock";I(s)}finally{z(!1)}else I("Please enter a shock serial number")},disabled:E,className:"flex-1 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors disabled:opacity-50",children:E?"Adding...":"Add Shock"})]})]})})}),_&&F&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-gray-900 rounded-lg max-w-lg w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Edit Shock"}),e.jsx("button",{onClick:()=>{S(!1),J()},className:"text-gray-400 hover:text-white",children:e.jsx(i,{className:"w-6 h-6"})})]}),B&&e.jsx("div",{className:"p-3 bg-red-500/20 border border-red-500 rounded-lg text-red-200 text-sm",children:B}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Serial Number *"}),e.jsx("input",{type:"text",value:A.serial_number,onChange:e=>P({...A,serial_number:e.target.value}),className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Dyno Sheet Photo"}),R?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:R,alt:"Dyno sheet preview",className:"w-full rounded-lg"}),e.jsx("button",{onClick:()=>{K(),T||U(null)},className:"absolute top-2 right-2 p-2 bg-red-500 text-white rounded-lg hover:bg-red-600",children:e.jsx(o,{className:"w-4 h-4"})})]}):e.jsxs("button",{onClick:Q,className:"w-full py-8 border-2 border-dashed border-gray-700 rounded-lg flex flex-col items-center justify-center gap-2 hover:border-orange-500 transition-colors",children:[e.jsx(a,{className:"w-8 h-8 text-gray-400"}),e.jsx("span",{className:"text-gray-400",children:"Take/Upload New Photo"})]}),e.jsx("input",{ref:q,type:"file",accept:"image/*",onChange:H,className:"hidden"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Last Refurbished"}),e.jsx("input",{type:"date",value:A.last_refurbished,onChange:e=>P({...A,last_refurbished:e.target.value}),className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Notes"}),e.jsx("textarea",{value:A.notes,onChange:e=>P({...A,notes:e.target.value}),rows:3,className:"w-full px-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:()=>{S(!1),J()},className:"flex-1 px-4 py-2 bg-gray-800 text-white rounded-lg hover:bg-gray-700 transition-colors",disabled:E,children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(F)try{z(!0),I(null),await y(F.id,{serial_number:A.serial_number,notes:A.notes||void 0,last_refurbished:A.last_refurbished||void 0,dyno_photo:null===T?null:T||void 0}),J(),S(!1)}catch(e){const s=e instanceof Error?e.message:"Failed to update shock";I(s)}finally{z(!1)}},disabled:E,className:"flex-1 px-4 py-2 bg-orange-500 text-white rounded-lg hover:bg-orange-600 transition-colors disabled:opacity-50",children:E?"Saving...":"Save Changes"})]})]})})}),C&&F&&F.dyno_photo_url&&e.jsx("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4",onClick:()=>D(!1),children:e.jsxs("div",{className:"relative max-w-4xl w-full",children:[e.jsx("button",{onClick:()=>D(!1),className:"absolute -top-12 right-0 text-white hover:text-orange-500 transition-colors",children:e.jsx(i,{className:"w-8 h-8"})}),e.jsx("img",{src:F.dyno_photo_url,alt:`Dyno sheet for ${F.serial_number}`,className:"w-full h-auto rounded-lg"}),e.jsxs("div",{className:"mt-4 text-center text-white",children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Shock: ",F.serial_number]}),F.last_refurbished&&e.jsxs("p",{className:"text-gray-400 mt-1",children:["Last Refurbished:"," ",new Date(F.last_refurbished).toLocaleDateString()]})]})]})})]})}export{m as default};

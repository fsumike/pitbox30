import{j as e,X as r,z as a,B as t,J as s,K as n,R as l,L as o,O as i,Q as d,a as c,V as m,c as g,p as u,f as x,W as h,D as b,Y as f,_ as p,$ as y,a0 as j,a1 as v,a2 as w}from"./ui-v2ReSvUE.js";import{r as k,b as N}from"./react-YWE4JMTy.js";import{u as S,a as C,s as _,i as F,b as E,t as R}from"./index-Cgc97SP_.js";import{u as D,R as z}from"./index-CsRCr0z8.js";import{N as L}from"./NumberInput-CMTJlAXY.js";import{u as T}from"./useShocks-C1UvY-iB.js";import{u as I}from"./router-BNBI7_bc.js";function $({isOpen:d,onClose:c,fieldGroups:m,onSave:g,onReset:u,loading:x=!1,error:h=null}){const[b,f]=k.useState(m);k.useEffect(()=>{f([...m])},[m]);const p=(e,r)=>{f(a=>{const t=[...a],s=t[e],n=Object.keys(s.visibleFields).reduce((e,a)=>(e[a]=r,e),{});return t[e]={...s,visibleFields:n},t})};return d?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-xl w-full max-w-2xl",onClick:e=>e.stopPropagation(),children:e.jsxs("div",{className:"relative p-6",children:[e.jsx("button",{onClick:c,className:"absolute top-4 right-4 p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full",children:e.jsx(r,{className:"w-6 h-6"})}),e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(a,{className:"w-6 h-6 text-red-500"}),e.jsx("h2",{className:"text-2xl font-bold",children:"Customize Fields"})]}),h&&e.jsxs("div",{className:"mb-6 p-3 rounded-lg bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 flex items-center gap-2",children:[e.jsx(t,{className:"w-5 h-5 flex-shrink-0"}),h]}),e.jsx("div",{className:"space-y-6 max-h-[60vh] overflow-y-auto pr-2",children:b.map((r,a)=>e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold",children:r.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>p(a,!0),className:"p-1.5 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors flex items-center gap-1",children:[e.jsx(s,{className:"w-4 h-4"}),e.jsx("span",{children:"Show All"})]}),e.jsxs("button",{onClick:()=>p(a,!1),className:"p-1.5 text-sm hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors flex items-center gap-1",children:[e.jsx(n,{className:"w-4 h-4"}),e.jsx("span",{children:"Hide All"})]})]})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:r.fields.map(t=>e.jsxs("button",{onClick:()=>((e,r)=>{f(a=>{const t=[...a];return t[e]={...t[e],visibleFields:{...t[e].visibleFields,[r]:!t[e].visibleFields[r]}},t})})(a,t),className:"p-2 rounded-lg text-left transition-colors flex items-center justify-between "+(r.visibleFields[t]?"bg-brand-gold/10 hover:bg-brand-gold/20":"bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700"),children:[e.jsx("span",{children:t}),r.visibleFields[t]?e.jsx(s,{className:"w-4 h-4"}):e.jsx(n,{className:"w-4 h-4"})]},t))})]},r.title))}),e.jsxs("div",{className:"flex justify-end gap-4 mt-6",children:[e.jsxs("button",{onClick:async()=>{if(u){if(await u()){const e=m.map(e=>{const r=e.fields.reduce((e,r)=>(e[r]=!0,e),{});return{...e,visibleFields:r}});f(e)}}else{const e=m.map(e=>{const r=e.fields.reduce((e,r)=>(e[r]=!0,e),{});return{...e,visibleFields:r}});f(e)}},className:"px-4 py-2 rounded-lg bg-gray-100 dark:bg-gray-800 hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors flex items-center gap-2",children:[e.jsx(l,{className:"w-5 h-5"}),"Reset to Default"]}),e.jsx("button",{onClick:()=>{g(b)},disabled:x,className:"px-4 py-2 rounded-lg bg-red-500 text-white hover:bg-red-700 transition-colors disabled:opacity-50 flex items-center gap-2",children:x?e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"w-5 h-5 animate-spin"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{className:"w-5 h-5"}),"Save Changes"]})})]})]})})}):null}function P({setupId:a}){var t;const{shocks:s,loading:n,getShocksBySetup:l,saveSetupShocks:o}=T(),i=I(),[g,u]=k.useState(!1),[x,h]=k.useState({LF:"",RF:"",LR:"",RR:""}),[b,f]=k.useState(null),[p,y]=k.useState(null);k.useEffect(()=>{a&&j()},[a]);const j=async()=>{if(a)try{const e=await l(a),r={LF:"",RF:"",LR:"",RR:""};e.forEach(e=>{e.shock&&(r[e.position]=e.shock.serial_number)}),h(r)}catch(e){}},v=async(e,r)=>{try{const a=Object.entries(r).filter(([,e])=>""!==e.trim()).map(([e,r])=>{const a=w(r);return a?{position:e,shock_id:a.id}:null}).filter(Boolean);await o(e,a)}catch(a){}},w=e=>s.find(r=>r.serial_number===e),N=[{key:"LF",label:"Left Front"},{key:"RF",label:"Right Front"},{key:"LR",label:"Left Rear"},{key:"RR",label:"Right Rear"}],S=Object.values(x).filter(e=>""!==e.trim()).length;return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>u(!g),className:"w-full flex items-center justify-between p-4 bg-gradient-to-r from-brand-gold/10 to-brand-gold-dark/10 hover:from-brand-gold/20 hover:to-brand-gold-dark/20 dark:from-orange-500/10 dark:to-orange-600/10 dark:hover:from-orange-500/20 dark:hover:to-orange-600/20 rounded-lg transition-all border border-brand-gold/30 hover:border-brand-gold dark:border-orange-500/20 dark:hover:border-orange-500/40",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-brand-gold/20 dark:bg-orange-500/20 rounded-lg",children:e.jsx(d,{className:"w-5 h-5 text-brand-gold dark:text-orange-500"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"Managed Shock Inventory"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:0===S?"No shocks assigned":`${S} of 4 shocks assigned`})]})]}),e.jsx(c,{className:"w-5 h-5 text-brand-gold dark:text-orange-500 transition-transform "+(g?"rotate-180":"")})]}),g&&e.jsxs("div",{className:"mt-3 space-y-3 animate-in fade-in slide-in-from-top-2 duration-300",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:()=>i("/tools"),className:"text-sm text-brand-gold hover:text-brand-gold-dark dark:text-orange-500 dark:hover:text-orange-400 flex items-center gap-1 transition-colors",children:[e.jsx(m,{className:"w-4 h-4"}),"Manage Inventory"]})}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:N.map(({key:t,label:s})=>{const n=w(x[t]);return e.jsxs("div",{className:"bg-white/50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 rounded-lg p-3 hover:border-brand-gold dark:hover:border-orange-500/30 transition-colors",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs font-semibold text-brand-gold dark:text-orange-500 uppercase tracking-wider",children:s}),x[t]&&e.jsx("button",{onClick:()=>(async e=>{const r={...x,[e]:""};h(r),a&&await v(a,r)})(t),className:"p-1 hover:bg-red-500/20 rounded transition-colors",children:e.jsx(r,{className:"w-3 h-3 text-red-500"})})]}),n?e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-bold text-gray-900 dark:text-white text-lg",children:n.serial_number}),e.jsx("button",{onClick:()=>f(t),className:"text-xs text-brand-gold hover:text-brand-gold-dark dark:text-orange-500 dark:hover:text-orange-400 transition-colors",children:"Change"})]}),n.dyno_photo_url?e.jsxs("div",{onClick:()=>y(n),className:"relative aspect-[4/3] bg-gray-200 dark:bg-gray-900 rounded overflow-hidden cursor-pointer group",children:[e.jsx("img",{src:n.dyno_photo_url,alt:`Dyno sheet for ${n.serial_number}`,className:"w-full h-full object-cover group-hover:opacity-80 transition-opacity"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity bg-black/40",children:e.jsx("span",{className:"bg-brand-gold dark:bg-orange-500 px-3 py-1 rounded text-white text-xs font-medium",children:"View Dyno Sheet"})})]}):e.jsx("div",{className:"aspect-[4/3] bg-gray-200 dark:bg-gray-900 rounded flex items-center justify-center",children:e.jsx(d,{className:"w-8 h-8 text-gray-400 dark:text-gray-600"})}),n.last_refurbished&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Refurb: ",new Date(n.last_refurbished).toLocaleDateString()]})]}):e.jsxs("button",{onClick:()=>f(t),className:"w-full py-6 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded hover:border-brand-gold dark:hover:border-orange-500 transition-colors flex flex-col items-center justify-center gap-2",children:[e.jsx(m,{className:"w-5 h-5 text-gray-400 dark:text-gray-500"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-500",children:"Select Shock"})]})]},t)})})]}),b&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-900 rounded-lg max-w-2xl w-full max-h-[80vh] overflow-hidden flex flex-col border border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:["Select Shock for ",null==(t=N.find(e=>e.key===b))?void 0:t.label]}),e.jsx("button",{onClick:()=>f(null),className:"text-gray-400 hover:text-gray-900 dark:hover:text-white transition-colors",children:e.jsx(r,{className:"w-6 h-6"})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-6",children:n?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-500"})}):0===s.length?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"No shocks in inventory"}),e.jsx("button",{onClick:()=>i("/tools"),className:"px-4 py-2 bg-brand-gold hover:bg-brand-gold-dark dark:bg-orange-500 text-white rounded-lg dark:hover:bg-orange-600 transition-colors",children:"Add Shocks to Inventory"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:s.map(r=>e.jsxs("button",{onClick:()=>(async(e,r)=>{const t={...x,[e]:r};h(t),f(null),a&&await v(a,t)})(b,r.serial_number),className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:border-brand-gold dark:hover:border-orange-500 transition-colors text-left",children:[e.jsx("h4",{className:"text-lg font-bold text-gray-900 dark:text-white mb-2",children:r.serial_number}),r.dyno_photo_url?e.jsx("div",{className:"aspect-video bg-gray-200 dark:bg-gray-900 rounded overflow-hidden",children:e.jsx("img",{src:r.dyno_photo_url,alt:`Dyno sheet for ${r.serial_number}`,className:"w-full h-full object-cover"})}):e.jsx("div",{className:"aspect-video bg-gray-200 dark:bg-gray-900 rounded flex items-center justify-center",children:e.jsx(d,{className:"w-6 h-6 text-gray-400 dark:text-gray-600"})}),r.last_refurbished&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:["Refurb: ",new Date(r.last_refurbished).toLocaleDateString()]})]},r.id))})})]})}),p&&p.dyno_photo_url&&e.jsx("div",{className:"fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4",onClick:()=>y(null),children:e.jsxs("div",{className:"relative max-w-4xl w-full",children:[e.jsx("button",{onClick:()=>y(null),className:"absolute -top-12 right-0 text-white hover:text-orange-500 transition-colors",children:e.jsx(r,{className:"w-8 h-8"})}),e.jsx("img",{src:p.dyno_photo_url,alt:`Dyno sheet for ${p.serial_number}`,className:"w-full h-auto rounded-lg"}),e.jsxs("div",{className:"mt-4 text-center text-white",children:[e.jsxs("h3",{className:"text-xl font-bold",children:["Shock: ",p.serial_number]}),p.last_refurbished&&e.jsxs("p",{className:"text-gray-400 mt-1",children:["Last Refurbished: ",new Date(p.last_refurbished).toLocaleDateString()]})]})]})})]})}const A=e=>{if(""===e||null==e)return"";const r="string"==typeof e?parseFloat(e):e;if(isNaN(r))return"";if(0===r)return"0";const a=r<0,t=Math.abs(r),s=Math.floor(t),n=t-s;if(0===n||n<.001)return 0===s?"0":(a?"-":"")+s.toString();const l={.125:"1/8",.25:"1/4",.375:"3/8",.5:"1/2",.625:"5/8",.75:"3/4",.875:"7/8"}[n.toFixed(3)];return l?0===s?(a?"-":"")+l:(a?"-":"")+s+" "+l:r.toString()};function q({title:r,carType:s,description:n,initialSetup:l,initialSetupData:d,sections:c,customizeButtonClassName:m="bg-red-500 hover:bg-red-700 text-white",carNumber:b,trackName:f,date:p}){const{user:y}=S(),{saveSetup:j,loading:v,error:w}=D(),{savedCustomization:N,loading:F,error:E,saveCustomization:R,resetCustomization:T}=function(e){const{user:r}=S(),[a,t]=k.useState(!1),[s,n]=k.useState(null),[l,o]=k.useState(null),{executeWithRetry:i}=C();k.useEffect(()=>{r&&d()},[r,e]);const d=async()=>{if(!r)return null;t(!0),n(null);try{const a=await i(async()=>{try{const a=new AbortController,t=setTimeout(()=>a.abort(),15e3),{data:s,error:n}=await _.from("setup_customizations").select("count").limit(1).abortSignal(a.signal);if(clearTimeout(t),n)throw new Error("Database connection failed: "+n.message);const{data:l,error:o}=await _.from("setup_customizations").select("*").eq("user_id",r.id).eq("car_type",e).maybeSingle().abortSignal(a.signal);if(o)throw"PGRST301"===o.code?new Error("Database connection failed: Invalid credentials"):"PGRST302"===o.code?new Error("Database connection failed: Insufficient permissions"):new Error(`Database error: ${o.message}`);return l}catch(a){if(a instanceof DOMException&&"AbortError"===a.name)throw new Error("Request timed out. Please try again.");if(a instanceof TypeError&&"Failed to fetch"===a.message)throw new Error("Network connection failed. Please check your internet connection.");throw a}});return(null==a?void 0:a.customization)?(o(a.customization),a.customization):null}catch(a){const e=a instanceof Error?a.message:"Failed to load customization settings";return n(e),null}finally{t(!1)}};return{savedCustomization:l,loading:a,error:s,loadCustomization:d,saveCustomization:async a=>{if(!r)return!1;t(!0),n(null);try{return await i(async()=>{try{const t=new AbortController,s=setTimeout(()=>t.abort(),15e3),{error:n}=await _.from("setup_customizations").select("count").limit(1).abortSignal(t.signal);if(n)throw new Error("Database connection failed: "+n.message);const{error:l}=await _.from("setup_customizations").upsert({user_id:r.id,car_type:e,customization:a,updated_at:(new Date).toISOString()},{onConflict:"user_id,car_type",ignoreDuplicates:!1}).abortSignal(t.signal);if(clearTimeout(s),l)throw"PGRST301"===l.code?new Error("Database connection failed: Invalid credentials"):"PGRST302"===l.code?new Error("Database connection failed: Insufficient permissions"):new Error(`Database error: ${l.message}`)}catch(t){if(t instanceof DOMException&&"AbortError"===t.name)throw new Error("Request timed out. Please try again.");if(t instanceof TypeError&&"Failed to fetch"===t.message)throw new Error("Network connection failed. Please check your internet connection.");throw t}}),o(a),!0}catch(s){const e=s instanceof Error?s.message:"Failed to save customization settings";return n(e),!1}finally{t(!1)}},resetCustomization:async()=>{if(!r)return!1;t(!0),n(null);try{return await i(async()=>{try{const a=new AbortController,t=setTimeout(()=>a.abort(),15e3),{error:s}=await _.from("setup_customizations").select("count").limit(1).abortSignal(a.signal);if(s)throw new Error("Database connection failed: "+s.message);const{error:n}=await _.from("setup_customizations").delete().eq("user_id",r.id).eq("car_type",e).abortSignal(a.signal);if(clearTimeout(t),n)throw"PGRST301"===n.code?new Error("Database connection failed: Invalid credentials"):"PGRST302"===n.code?new Error("Database connection failed: Insufficient permissions"):new Error(`Database error: ${n.message}`)}catch(a){if(a instanceof DOMException&&"AbortError"===a.name)throw new Error("Request timed out. Please try again.");if(a instanceof TypeError&&"Failed to fetch"===a.message)throw new Error("Network connection failed. Please check your internet connection.");throw a}}),o(null),!0}catch(a){const e=a instanceof Error?a.message:"Failed to reset customization settings";return n(e),!1}finally{t(!1)}}}}(s),[I,q]=k.useState(d),[O,K]=k.useState(null),[M,G]=k.useState([]),[U,B]=k.useState(!1),[Y,W]=k.useState(!1),[H,V]=k.useState([]),[Z,J]=k.useState(""),[Q,X]=k.useState(""),[ee,re]=k.useState(!1),[ae,te]=k.useState((null==l?void 0:l.id)||null);k.useEffect(()=>{(null==l?void 0:l.setup_data)&&q(l.setup_data),(null==l?void 0:l.best_lap_time)&&J(l.best_lap_time.toString()),(null==l?void 0:l.race_type)&&X(l.race_type)},[l]),k.useEffect(()=>{void 0===b&&void 0===f&&void 0===p||q(e=>{var r,a,t;return{...e,general:{...e.general,...void 0!==b&&{car_number:{...null==(r=e.general)?void 0:r.car_number,feature:b}},...void 0!==f&&{track_track:{...null==(a=e.general)?void 0:a.track_track,feature:f}},...void 0!==p&&{date:{...null==(t=e.general)?void 0:t.date,feature:p}}}}})},[b,f,p]),k.useEffect(()=>{if(N)V(N);else{const e=c.map(e=>({title:e.title,fields:e.fields,expanded:!0,visibleFields:e.fields.reduce((e,r)=>(e[r]=!0,e),{}),bgColor:e.bgColor}));V(e)}},[N,c]);const se=async()=>{if(y)try{const e=Z?parseFloat(Z):null,r=Q||null,a=await j(s,I,{},e,r);a&&(te(a.id),W(!0),setTimeout(()=>W(!1),3e3))}catch(e){}},ne=(e,r)=>{var a,t;return(null==(t=null==(a=I[e])?void 0:a[r])?void 0:t.feature)||""},le=e=>e.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()),oe=(e,r)=>{var a;const t=H.find(r=>r.title===e);return!1!==(null==(a=null==t?void 0:t.visibleFields)?void 0:a[r])},ie=e=>{const r=c.find(r=>r.title===e);return(null==r?void 0:r.bgColor)?r.bgColor:{General:"from-brand-gold/10 to-brand-gold-dark/10 dark:from-brand-gold/15 dark:to-brand-gold-dark/15",Other:"from-gray-400/10 to-gray-500/10 dark:from-gray-400/15 dark:to-gray-500/15","Left Front":"from-brand-gold/8 to-amber-600/8 dark:from-brand-gold/12 dark:to-amber-600/12","Right Front":"from-gray-400/10 to-gray-500/10 dark:from-gray-400/15 dark:to-gray-500/15","Left Rear":"from-brand-gold/8 to-amber-600/8 dark:from-brand-gold/12 dark:to-amber-600/12","Right Rear":"from-gray-400/10 to-gray-500/10 dark:from-gray-400/15 dark:to-gray-500/15",Rear:"from-brand-gold/8 to-amber-600/8 dark:from-brand-gold/12 dark:to-amber-600/12",Front:"from-gray-400/10 to-gray-500/10 dark:from-gray-400/15 dark:to-gray-500/15",Suspension:"from-gray-400/10 to-gray-500/10 dark:from-gray-400/15 dark:to-gray-500/15",Shocks:"from-brand-gold/8 to-amber-600/8 dark:from-brand-gold/12 dark:to-amber-600/12",Wings:"from-gray-400/10 to-gray-500/10 dark:from-gray-400/15 dark:to-gray-500/15",Engine:"from-brand-gold/10 to-brand-gold-dark/10 dark:from-brand-gold/15 dark:to-brand-gold-dark/15"}[e]||"from-gray-400/10 to-gray-500/10 dark:from-gray-400/15 dark:to-gray-500/15"};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"glass-panel p-6 bg-gradient-to-br from-brand-gold/10 to-brand-gold-dark/10",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold mb-2",children:[r," Setup Sheet"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:n})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("button",{onClick:()=>B(!0),className:`px-4 py-2 rounded-lg transition-colors flex items-center gap-2 ${m}`,children:[e.jsx(a,{className:"w-5 h-5"}),e.jsx("span",{children:"Customize Fields"})]}),e.jsx("button",{onClick:se,disabled:v||!y,className:"px-4 py-2 bg-brand-gold text-white rounded-lg hover:bg-brand-gold-dark transition-colors disabled:opacity-50 flex items-center gap-2",children:v?e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"w-5 h-5 animate-spin"}),"Saving..."]}):Y?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"w-5 h-5"}),"Saved!"]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{className:"w-5 h-5"}),"Save Setup"]})})]})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",children:[e.jsx(u,{className:"w-4 h-4 text-brand-gold"}),"Best Lap Time (optional)"]}),e.jsxs("div",{className:"flex gap-2 items-center max-w-md",children:[e.jsx("input",{type:"text",inputMode:"decimal",value:Z,onChange:e=>J(e.target.value),placeholder:"15.234",className:"flex-1 px-4 py-2 bg-white/50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700 focus:outline-none focus:ring-2 focus:ring-brand-gold"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"seconds"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Enter your best lap time for this setup"})]}),e.jsxs("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm font-medium mb-2",children:[e.jsx(x,{className:"w-4 h-4 text-brand-gold"}),"Race Type (optional)"]}),e.jsxs("select",{value:Q,onChange:e=>X(e.target.value),className:"w-full max-w-md px-4 py-2 bg-white/50 dark:bg-gray-800/50 rounded-lg border border-gray-200 dark:border-gray-700 focus:outline-none focus:ring-2 focus:ring-brand-gold",children:[e.jsx("option",{value:"",children:"Select race type..."}),z.map(r=>e.jsx("option",{value:r.value,children:r.label},r.value))]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"Track what type of race this setup was used for"})]}),e.jsx("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4",children:e.jsx(P,{setupId:ae||void 0})}),(w||E)&&e.jsxs("div",{className:"mt-4 p-3 rounded-lg bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 flex items-center gap-2",children:[e.jsx(t,{className:"w-5 h-5 flex-shrink-0"}),w||E]})]}),e.jsx("div",{className:"space-y-4",children:H.map((r,a)=>{const t=r.title.toLowerCase().replace(/\s+/g,"_"),s=M.includes(t),n=r.fields.filter(e=>oe(r.title,e)).length;return 0===n?null:e.jsxs("div",{className:`glass-panel overflow-hidden bg-gradient-to-br ${ie(r.title)} border-2 border-gray-200 dark:border-gray-700 shadow-md`,children:[e.jsxs("button",{onClick:()=>(e=>{G(r=>r.includes(e)?r.filter(r=>r!==e):[...r,e])})(t),className:"w-full p-4 text-left hover:bg-white/5 transition-colors flex items-center justify-between",children:[e.jsx("h3",{className:"text-xl font-bold",children:r.title}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[n," fields"]}),e.jsx(x,{className:"w-5 h-5 transition-transform "+(s?"rotate-180":"")})]})]}),s&&e.jsx("div",{className:"p-4 pt-0 space-y-4",children:e.jsx("div",{className:"bg-white/60 dark:bg-gray-900/40 p-4 rounded-lg",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:r.fields.map(a=>{if(!oe(r.title,a))return null;const s=ne(t,a),n=((e,r)=>{var a,t;return(null==(t=null==(a=I[e])?void 0:a[r])?void 0:t.comment)||""})(t,a);return e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"block text-sm font-medium",children:le(a)}),e.jsx("button",{onClick:()=>((e,r)=>{const a=r.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase());K({sectionKey:e,fieldKey:r,title:`Enter ${a}`})})(t,a),className:"w-full p-3 text-left bg-white dark:bg-gray-800 rounded-lg border-2 border-gray-300 dark:border-gray-600 hover:border-brand-gold hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors shadow-sm font-medium",children:e.jsx("span",{className:s?"text-gray-900 dark:text-gray-100":"text-gray-500 dark:text-gray-400",children:s?A(s):"Click to enter value"})}),e.jsx("textarea",{value:n,onChange:e=>((e,r,a)=>{q(t=>{var s;return{...t,[e]:{...t[e],[r]:{...null==(s=t[e])?void 0:s[r],comment:a}}}})})(t,a,e.target.value),placeholder:"Add notes or comments...",className:"w-full p-3 text-sm bg-gray-50 dark:bg-gray-800 rounded-lg border-2 border-gray-300 dark:border-gray-600 focus:border-brand-gold focus:ring-2 focus:ring-brand-gold/20 transition-colors shadow-sm placeholder:text-gray-400",rows:2})]},a)})})})})]},r.title)})}),O&&e.jsx(L,{value:ne(O.sectionKey,O.fieldKey),onChange:e=>{O&&(q(r=>{var a;return{...r,[O.sectionKey]:{...r[O.sectionKey],[O.fieldKey]:{...null==(a=r[O.sectionKey])?void 0:a[O.fieldKey],feature:e}}}}),K(null))},title:O.title,onClose:()=>K(null)}),e.jsx($,{isOpen:U,onClose:()=>B(!1),fieldGroups:H,onSave:async e=>{await R(e)&&(V(e),B(!1))},onReset:async()=>{const e=await T();if(e){const e=c.map(e=>({title:e.title,fields:e.fields,expanded:!0,visibleFields:e.fields.reduce((e,r)=>(e[r]=!0,e),{}),bgColor:e.bgColor}));V(e)}return e},loading:F,error:E}),e.jsxs("div",{className:"glass-panel p-6 bg-gradient-to-br from-brand-gold/10 to-brand-gold-dark/10",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-stretch sm:items-center",children:[e.jsx("button",{onClick:se,disabled:v||!y,className:"flex-1 sm:flex-initial px-6 py-3 bg-brand-gold text-white rounded-lg hover:bg-brand-gold-dark transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2 font-semibold text-lg",children:v?e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"w-6 h-6 animate-spin"}),"Saving..."]}):Y?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"w-6 h-6"}),"Saved!"]}):e.jsxs(e.Fragment,{children:[e.jsx(i,{className:"w-6 h-6"}),"Save Setup"]})}),e.jsxs("button",{onClick:()=>re(!0),className:"flex-1 sm:flex-initial px-6 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors flex items-center justify-center gap-2 font-semibold",children:[e.jsx(h,{className:"w-5 h-5"}),"Restore Default Settings"]})]}),!y&&e.jsx("p",{className:"mt-4 text-sm text-gray-600 dark:text-gray-400 text-center",children:"Sign in to save your setups"})]}),ee&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(t,{className:"w-6 h-6 text-red-500 flex-shrink-0 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Confirm Reset"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Are you sure you want to restore default settings? This will clear all your current setup data and cannot be undone."})]})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>re(!1),className:"flex-1 px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium",children:"Cancel"}),e.jsx("button",{onClick:()=>{q(d),J(""),re(!1),W(!1)},className:"flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors font-medium",children:"Reset All Data"})]})]})})]})}function O({carType:r}){const a=I();return e.jsxs("button",{onClick:()=>{a(`/setups/${r}`)},className:"w-full md:w-auto btn-primary flex items-center justify-center gap-3 px-8 py-4 text-lg font-semibold shadow-lg hover:shadow-xl transform transition-all duration-200 hover:-translate-y-0.5 rounded-xl",children:[e.jsx(b,{className:"w-7 h-7"}),e.jsx("span",{children:"Load Saved Setups"})]})}function K({title:a,type:s}){const[n,l]=k.useState([]),[d,m]=k.useState(null),[g,u]=k.useState(1),[x,h]=k.useState(null),[C,D]=k.useState(!1),[z,L]=k.useState(!1),T=k.useRef(null),{saveDynoImage:I,loadDynoImages:$,deleteDynoImage:P,loading:A,error:q}=function(){const{user:e}=S(),[r,a]=k.useState(!1),[t,s]=k.useState(null);return{saveDynoImage:async(r,t,n)=>{if(!e)return s("You must be signed in to save dyno images"),null;a(!0),s(null);try{const{data:a,error:s}=await _.from("profiles").select("id").eq("id",e.id).single();if(s){const{error:r}=await _.from("profiles").insert([{id:e.id,username:e.email}]);if(r)throw r}const{data:l,error:o}=await _.from("dyno_images").insert([{user_id:e.id,setup_id:n||null,type:r,url:t}]).select().single();if(o)throw o;return l}catch(l){return s("Failed to save dyno image"),null}finally{a(!1)}},loadDynoImages:async r=>{if(!e)return s("You must be signed in to load dyno images"),[];a(!0),s(null);try{const{data:a,error:t}=await _.from("dyno_images").select("*").eq("user_id",e.id).eq("type",r).order("created_at",{ascending:!1});if(t)throw t;return a||[]}catch(t){return s("Failed to load dyno images"),[]}finally{a(!1)}},deleteDynoImage:async r=>{if(!e)return s("You must be signed in to delete dyno images"),!1;a(!0),s(null);try{const{error:a}=await _.from("dyno_images").delete().eq("id",r).eq("user_id",e.id);if(a)throw a;return!0}catch(t){return s("Failed to delete dyno image"),!1}finally{a(!1)}},loading:r,error:t}}(),{user:O}=S();k.useEffect(()=>{O&&M()},[O]);const K=e=>{l(r=>[...r,{type:s,url:e,timestamp:(new Date).toLocaleString()}])},M=async()=>{if(!O)return;const e=await $(s);if(e.length>0){const r=e.map(e=>({id:e.id,type:e.type,url:e.url,timestamp:new Date(e.created_at).toLocaleString()}));l(e=>{const a=new Set(e.filter(e=>e.id).map(e=>e.id)),t=r.filter(e=>!a.has(e.id));return[...e,...t]})}},G=()=>{m(null),u(1),document.body.style.overflow="unset"},U=e=>{u(r=>{const a="in"===e?r+.25:r-.25;return Math.max(.5,Math.min(3,a))})};return N.useEffect(()=>{const e=e=>{"Escape"===e.key&&d&&G()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[d]),e.jsxs("div",{className:"glass-panel p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"text-2xl font-bold",children:[a," Dyno"]}),e.jsx("button",{onClick:()=>L(!z),className:"flex items-center gap-2 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-expanded":z,"aria-label":z?"Collapse section":"Expand section",children:z?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:"Hide Images"})]}):e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm font-medium",children:n.length>0?`Show Images (${n.length})`:"Show Upload Options"})]})})]}),z&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap gap-4 mb-6",children:[e.jsxs("button",{onClick:async()=>{if(F){const e=await E();e&&(K(e),L(!0))}else T.current&&T.current.click()},className:"btn-accent flex items-center gap-2 px-4 py-2","aria-label":"Upload image",children:[e.jsx(p,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Upload Image"}),e.jsx("span",{className:"sm:hidden",children:"Upload"})]}),e.jsxs("button",{onClick:async()=>{if(F){const e=await R();e&&(K(e),L(!0))}else T.current&&T.current.click()},className:"btn-primary flex items-center gap-2 px-4 py-2","aria-label":"Take photo",children:[e.jsx(y,{className:"w-5 h-5"}),e.jsx("span",{children:"Take Photo"})]}),e.jsxs("button",{onClick:M,className:"btn-primary flex items-center gap-2 px-4 py-2",disabled:A||!O,children:[e.jsx(b,{className:"w-5 h-5"}),e.jsx("span",{className:"hidden sm:inline",children:"Load Saved Images"}),e.jsx("span",{className:"sm:hidden",children:"Load Saved"})]}),e.jsx("input",{ref:T,type:"file",accept:"image/*",className:"hidden",onChange:e=>{var r;const a=null==(r=e.target.files)?void 0:r[0];if(a){const r=new FileReader;r.onload=e=>{var r;(null==(r=e.target)?void 0:r.result)&&(K(e.target.result),L(!0))},r.readAsDataURL(a),e.target.value=""}}})]}),q&&e.jsx("div",{className:"mb-4 p-3 rounded-lg bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300",children:q}),A&&e.jsxs("div",{className:"flex items-center justify-center p-4",children:[e.jsx(o,{className:"w-6 h-6 animate-spin mr-2"}),e.jsx("span",{children:"Loading..."})]}),0===n.length?e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg",children:["No ",a.toLowerCase()," dyno images yet. Upload or take a photo to add one."]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:n.map((r,a)=>e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"group",children:[e.jsx("img",{src:r.url,alt:`${s} dyno ${a+1}`,className:"w-full h-48 object-cover rounded-lg cursor-pointer transition-transform hover:scale-[1.02]",onClick:()=>(e=>{m(e),u(1),document.body.style.overflow="hidden"})(r)}),r.id?e.jsx("div",{className:"absolute top-2 right-2 bg-green-500/80 text-white text-xs px-2 py-1 rounded-full",children:"Saved"}):e.jsx("button",{onClick:()=>(async(e,r)=>{if(!O)return;const a=await I(s,e);a&&l(e=>e.map((e,t)=>t===r?{...e,id:a.id}:e))})(r.url,a),className:"absolute top-2 right-2 bg-blue-500/80 hover:bg-blue-600/80 text-white p-1.5 rounded-full opacity-0 group-hover:opacity-100 transition-opacity",title:"Save to cloud",children:e.jsx(i,{className:"w-4 h-4"})})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.timestamp}),x!==`${a}`?e.jsx("button",{onClick:()=>h(`${a}`),className:"text-red-500 hover:text-red-600 dark:text-red-400 dark:hover:text-red-300 p-1 rounded transition-colors",title:"Delete image",children:e.jsx(j,{className:"w-5 h-5"})}):e.jsxs("div",{className:"flex items-center gap-1 bg-red-100 dark:bg-red-900/30 p-1 rounded",children:[e.jsx(t,{className:"w-4 h-4 text-red-500"}),e.jsx("button",{onClick:()=>(e=>{const r=n[e];r.id?P(r.id).then(r=>{r&&l(r=>r.filter((r,a)=>a!==e))}):l(r=>r.filter((r,a)=>a!==e)),h(null)})(a),className:"text-red-500 hover:text-red-700 text-sm font-medium px-1",children:"Delete"}),e.jsx("button",{onClick:()=>h(null),className:"text-gray-500 hover:text-gray-700 text-sm font-medium px-1",children:"Cancel"})]})]})]},a))})]}),d&&e.jsxs("div",{className:"fixed inset-0 bg-black/90 z-50 flex flex-col items-center justify-center p-4",onClick:G,children:[e.jsxs("div",{className:"absolute top-0 left-0 right-0 flex justify-between items-center p-4 bg-black/50",children:[e.jsxs("button",{onClick:G,className:"p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-colors flex items-center gap-2",title:"Close viewer (Esc)",children:[e.jsx(r,{className:"w-6 h-6"}),e.jsx("span",{className:"text-sm font-medium",children:"Close"})]}),e.jsxs("div",{className:"flex items-center gap-2 bg-white/10 rounded-full p-1",children:[e.jsx("button",{onClick:e=>{e.stopPropagation(),U("out")},className:"p-2 hover:bg-white/20 rounded-full text-white transition-colors",title:"Zoom out",children:e.jsx(v,{className:"w-5 h-5"})}),e.jsx("button",{onClick:e=>{e.stopPropagation(),U("in")},className:"p-2 hover:bg-white/20 rounded-full text-white transition-colors",title:"Zoom in",children:e.jsx(w,{className:"w-5 h-5"})})]})]}),e.jsx("div",{onClick:e=>e.stopPropagation(),className:"relative max-w-[90vw] max-h-[80vh] overflow-auto mt-16",children:e.jsx("img",{src:d.url,alt:"Enlarged view",className:"rounded-lg transition-transform duration-200",style:{transform:`scale(${g})`,cursor:"grab"}})}),e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 text-white/60 text-sm",children:"Tap anywhere to close"})]})]})}function M({value:r,onChange:a,className:t=""}){return e.jsxs("div",{className:`glass-panel p-4 ${t}`,children:[e.jsx("label",{htmlFor:"car-number",className:"block text-lg font-bold mb-2",children:"Car Number"}),e.jsx("input",{id:"car-number",type:"text",value:r,onChange:e=>a(e.target.value),className:"w-full p-3 text-center text-2xl font-bold rounded-lg bg-white/50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700",placeholder:"#"})]})}export{M as C,K as D,O as L,q as S};

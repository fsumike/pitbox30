import{r as e}from"./react-CLW9qjVv.js";import{u as t,s as r}from"./index-DMaHBciH.js";function c(){const{user:c}=t(),[a,i]=e.useState(!1),[o,s]=e.useState(null),l=async e=>{i(!0),s(null);try{const{data:t,error:c}=await r.from("default_checklists").select("*").eq("vehicle_type",e).maybeSingle();if(c&&"PGRST116"!==c.code)throw c;return t?t.checklist_data:{post_race:[{id:crypto.randomUUID(),text:"Check tire wear and damage",completed:!1,category:"post_race"},{id:crypto.randomUUID(),text:"Inspect suspension components",completed:!1,category:"post_race"},{id:crypto.randomUUID(),text:"Check engine oil level",completed:!1,category:"post_race"}],shop:[{id:crypto.randomUUID(),text:"Clean and inspect chassis",completed:!1,category:"shop"},{id:crypto.randomUUID(),text:"Service engine if needed",completed:!1,category:"shop"},{id:crypto.randomUUID(),text:"Check and adjust setup",completed:!1,category:"shop"}],pre_race:[{id:crypto.randomUUID(),text:"Check tire pressures",completed:!1,category:"pre_race"},{id:crypto.randomUUID(),text:"Verify safety equipment",completed:!1,category:"pre_race"},{id:crypto.randomUUID(),text:"Final setup adjustments",completed:!1,category:"pre_race"}]}}catch(t){return s("Failed to load default checklist"),null}finally{i(!1)}},n=async e=>{if(!c)return s("You must be signed in to delete checklists"),!1;i(!0),s(null);try{const{error:t}=await r.from("maintenance_checklists").delete().eq("user_id",c.id).eq("vehicle_type",e);if(t)throw t;return!0}catch(t){return s("Failed to delete checklist"),!1}finally{i(!1)}};return{getChecklist:async e=>{if(!c)return s("You must be signed in to access checklists"),null;i(!0),s(null);try{const{data:t,error:a}=await r.from("maintenance_checklists").select("*").eq("user_id",c.id).eq("vehicle_type",e).maybeSingle();if(a)throw a;return(null==t?void 0:t.checklist_data)||null}catch(t){return"PGRST116"!==t.code&&s("Failed to load checklist"),null}finally{i(!1)}},getDefaultChecklist:l,saveChecklist:async(e,t)=>{if(!c)return s("You must be signed in to save checklists"),!1;i(!0),s(null);try{const{error:a}=await r.from("maintenance_checklists").upsert({user_id:c.id,vehicle_type:e,checklist_data:t,updated_at:(new Date).toISOString()},{onConflict:"user_id,vehicle_type",ignoreDuplicates:!1});if(a)throw a;return!0}catch(a){return s((null==a?void 0:a.message)||"Failed to save checklist"),!1}finally{i(!1)}},deleteChecklist:n,restoreDefaultChecklist:async e=>{try{return await n(e),await l(e)}catch(t){return s("Failed to restore default checklist"),null}},loading:a,error:o}}export{c as u};

import{j as e,f as r,L as a,aX as s,a9 as t,b5 as l,V as n,a0 as d}from"./ui-a5pT2S0L.js";import{r as i}from"./react-CLW9qjVv.js";import{u as o,s as c}from"./index-DMaHBciH.js";import"./supabase-Dols_XF-.js";import"./router-CsjlwGXH.js";function g(){const{user:g}=o(),{bars:m,loading:x,saveTorsionBar:h,deleteTorsionBar:b,updateTorsionBar:u}=function(){const{user:e}=o(),[r,a]=i.useState([]),[s,t]=i.useState(!0),[l,n]=i.useState(null);i.useEffect((()=>{e?d():(a([]),t(!1))}),[e]);const d=async()=>{if(e){t(!0);try{const{data:r,error:s}=await c.from("torsion_bars").select("*").eq("user_id",e.id).order("location",{ascending:!0});if(s)throw s;a(r||[])}catch(r){n("Failed to load torsion bars")}finally{t(!1)}}};return{bars:r,loading:s,error:l,saveTorsionBar:async r=>{if(!e)return n("You must be signed in to save torsion bars"),!1;t(!0),n(null);try{const{data:a}=await c.from("profiles").select("id").eq("id",e.id).maybeSingle();if(!a){const{error:r}=await c.from("profiles").insert([{id:e.id,username:e.email}]);if(r)throw r}const{error:s}=await c.from("torsion_bars").insert([{user_id:e.id,diameter:r.diameter,length:r.length,rate:r.rate,location:r.location,brand:r.brand||"",notes:r.notes||"",in_car:r.in_car}]);if(s)throw s;return await d(),!0}catch(a){return n("Failed to save torsion bar"),!1}finally{t(!1)}},updateTorsionBar:async(r,a)=>{if(!e)return n("You must be signed in to update torsion bars"),!1;t(!0),n(null);try{const{error:s}=await c.from("torsion_bars").update({...a,updated_at:(new Date).toISOString()}).eq("id",r).eq("user_id",e.id);if(s)throw s;return await d(),!0}catch(s){return n("Failed to update torsion bar"),!1}finally{t(!1)}},deleteTorsionBar:async r=>{if(!e)return n("You must be signed in to delete torsion bars"),!1;t(!0),n(null);try{const{error:a}=await c.from("torsion_bars").delete().eq("id",r).eq("user_id",e.id);if(a)throw a;return await d(),!0}catch(a){return n("Failed to delete torsion bar"),!1}finally{t(!1)}},refreshBars:d}}(),[p,y]=i.useState(!1);i.useState(!0);const[f,j]=i.useState({diameter:1,length:36,rate:0,location:"LF",brand:"",notes:"",in_car:!1}),[N,v]=i.useState({diameter:1,length:36,armLength:12,shearModulus:115e5}),k=(e,r,a=12,s=115e5)=>{const t=e,l=r,n=a,d=s*Math.PI*Math.pow(t,4)/(32*l)/Math.pow(n,2);return Math.round(d)};i.useEffect((()=>{const e=k(N.diameter,N.length,N.armLength,N.shearModulus);v((r=>({...r,calculatedRate:e})))}),[N.diameter,N.length,N.armLength,N.shearModulus]);const w=e=>{switch(e){case"LF":return"bg-blue-500";case"RF":return"bg-green-500";case"LR":return"bg-orange-500";case"RR":return"bg-red-500";default:return"bg-gray-500"}};return g?x?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(a,{className:"w-8 h-8 animate-spin text-brand-gold"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-orange-500/10 to-red-500/10 rounded-xl p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(s,{className:"w-6 h-6 text-orange-600"}),e.jsx("h3",{className:"text-xl font-bold",children:"Torsion Bar Calculator"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Diameter (inches)"}),e.jsx("input",{type:"number",step:"0.0625",value:N.diameter,onChange:e=>v((r=>({...r,diameter:parseFloat(e.target.value)||0}))),className:"w-full px-4 py-2 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-lg focus:border-brand-gold focus:outline-none",style:{minHeight:"44px"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Length (inches)"}),e.jsx("input",{type:"number",step:"1",value:N.length,onChange:e=>v((r=>({...r,length:parseFloat(e.target.value)||0}))),className:"w-full px-4 py-2 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-lg focus:border-brand-gold focus:outline-none",style:{minHeight:"44px"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Arm Length (inches)"}),e.jsx("input",{type:"number",step:"0.5",value:N.armLength,onChange:e=>v((r=>({...r,armLength:parseFloat(e.target.value)||0}))),className:"w-full px-4 py-2 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-lg focus:border-brand-gold focus:outline-none",style:{minHeight:"44px"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Material (Shear Modulus)"}),e.jsxs("select",{value:N.shearModulus,onChange:e=>v((r=>({...r,shearModulus:parseInt(e.target.value)}))),className:"w-full px-4 py-2 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-lg focus:border-brand-gold focus:outline-none",style:{minHeight:"44px"},children:[e.jsx("option",{value:"11500000",children:"Steel (Standard)"}),e.jsx("option",{value:"11000000",children:"Steel (Softer)"}),e.jsx("option",{value:"12000000",children:"Steel (Harder)"})]})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border-2 border-orange-500",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Calculated Wheel Rate"}),e.jsx("p",{className:"text-4xl font-bold text-orange-600",children:k(N.diameter,N.length,N.armLength,N.shearModulus)}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"lbs/in"})]})})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(t,{className:"w-5 h-5 text-blue-600"}),e.jsx("h4",{className:"font-semibold",children:"Track Condition Recommendations"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-blue-200 dark:border-blue-800",children:[e.jsx("th",{className:"text-left py-2 px-2",children:"Track Type"}),e.jsx("th",{className:"text-center py-2 px-2",children:"LF"}),e.jsx("th",{className:"text-center py-2 px-2",children:"RF"}),e.jsx("th",{className:"text-center py-2 px-2",children:"LR"}),e.jsx("th",{className:"text-center py-2 px-2",children:"RR"})]})}),e.jsx("tbody",{children:[{type:"Slick Track",lfRate:"175-200",rfRate:"200-225",lrRate:"175-200",rrRate:"200-225"},{type:"Heavy Track",lfRate:"200-225",rfRate:"225-250",lrRate:"200-225",rrRate:"225-250"},{type:"Tacky Track",lfRate:"150-175",rfRate:"175-200",lrRate:"150-175",rrRate:"175-200"}].map(((r,a)=>e.jsxs("tr",{className:"border-b border-blue-100 dark:border-blue-900/50",children:[e.jsx("td",{className:"py-2 px-2 font-medium",children:r.type}),e.jsx("td",{className:"text-center py-2 px-2",children:r.lfRate}),e.jsx("td",{className:"text-center py-2 px-2",children:r.rfRate}),e.jsx("td",{className:"text-center py-2 px-2",children:r.lrRate}),e.jsx("td",{className:"text-center py-2 px-2",children:r.rrRate})]},a)))})]})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:"w-5 h-5 text-brand-gold"}),e.jsx("h3",{className:"text-lg font-bold",children:"Bar Inventory"}),e.jsxs("span",{className:"text-sm text-gray-500",children:["(",m.length," bars)"]})]}),e.jsxs("button",{onClick:()=>y(!p),className:"px-4 py-2 bg-brand-gold text-white rounded-lg hover:bg-brand-gold-dark inline-flex items-center gap-2 transition-colors",style:{minHeight:"44px"},children:[e.jsx(n,{className:"w-5 h-5"}),"Add Bar"]})]}),p&&e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-lg p-4 mb-4 space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Diameter (inches)"}),e.jsx("input",{type:"number",step:"0.0625",value:f.diameter,onChange:e=>j((r=>({...r,diameter:parseFloat(e.target.value)||0}))),className:"w-full px-4 py-2 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-lg focus:border-brand-gold focus:outline-none",style:{minHeight:"44px"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Length (inches)"}),e.jsx("input",{type:"number",step:"1",value:f.length,onChange:e=>j((r=>({...r,length:parseFloat(e.target.value)||0}))),className:"w-full px-4 py-2 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-lg focus:border-brand-gold focus:outline-none",style:{minHeight:"44px"}})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Location"}),e.jsxs("select",{value:f.location,onChange:e=>j((r=>({...r,location:e.target.value}))),className:"w-full px-4 py-2 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-lg focus:border-brand-gold focus:outline-none",style:{minHeight:"44px"},children:[e.jsx("option",{value:"LF",children:"Left Front"}),e.jsx("option",{value:"RF",children:"Right Front"}),e.jsx("option",{value:"LR",children:"Left Rear"}),e.jsx("option",{value:"RR",children:"Right Rear"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Brand"}),e.jsx("input",{type:"text",value:f.brand,onChange:e=>j((r=>({...r,brand:e.target.value}))),placeholder:"e.g., Schroeder, AFCO",className:"w-full px-4 py-2 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-lg focus:border-brand-gold focus:outline-none",style:{minHeight:"44px"}})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Notes"}),e.jsx("input",{type:"text",value:f.notes,onChange:e=>j((r=>({...r,notes:e.target.value}))),placeholder:"Optional notes",className:"w-full px-4 py-2 bg-white dark:bg-gray-800 border-2 border-gray-200 dark:border-gray-700 rounded-lg focus:border-brand-gold focus:outline-none",style:{minHeight:"44px"}})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:async()=>{if(!g)return;const e={...f,rate:k(f.diameter,f.length)};await h(e)&&(j({diameter:1,length:36,rate:0,location:"LF",brand:"",notes:"",in_car:!1}),y(!1))},disabled:x,className:"flex-1 px-4 py-2 bg-brand-gold text-white rounded-lg hover:bg-brand-gold-dark disabled:opacity-50 font-medium",style:{minHeight:"44px"},children:"Save Bar"}),e.jsx("button",{onClick:()=>y(!1),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600",style:{minHeight:"44px"},children:"Cancel"})]})]}),0===m.length?e.jsxs("div",{className:"text-center py-12 bg-gray-50 dark:bg-gray-800/50 rounded-lg",children:[e.jsx(l,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"No torsion bars in inventory"})]}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4",children:m.map((r=>e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border-2 "+(r.in_car?"border-green-500 shadow-lg":"border-gray-200 dark:border-gray-700"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${w(r.location)}`}),e.jsx("span",{className:"font-bold text-lg",children:r.location})]}),e.jsx("button",{onClick:()=>(async e=>{g&&confirm("Delete this torsion bar?")&&await b(e)})(r.id),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:e.jsx(d,{className:"w-4 h-4 text-red-500"})})]}),e.jsxs("div",{className:"space-y-2 mb-3",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Diameter:"}),e.jsxs("span",{className:"font-medium",children:[r.diameter,'"']})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Length:"}),e.jsxs("span",{className:"font-medium",children:[r.length,'"']})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Rate:"}),e.jsxs("span",{className:"font-bold text-brand-gold",children:[r.rate," lbs/in"]})]}),r.brand&&e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Brand:"}),e.jsx("span",{className:"font-medium",children:r.brand})]}),r.notes&&e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2 italic",children:r.notes})]}),e.jsx("button",{onClick:()=>(async e=>{g&&e.id&&await u(e.id,{in_car:!e.in_car})})(r),className:"w-full py-2 px-4 rounded-lg font-medium transition-colors "+(r.in_car?"bg-green-500 text-white hover:bg-green-600":"bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600"),style:{minHeight:"40px"},children:r.in_car?"In Car":"In Storage"})]},r.id)))})]}),e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 rounded-lg p-4",children:[e.jsxs("h4",{className:"font-semibold mb-2 flex items-center gap-2",children:[e.jsx(r,{className:"w-5 h-5 text-orange-600"}),"Torsion Bar Tips"]}),e.jsxs("ul",{className:"text-sm space-y-1 text-gray-600 dark:text-gray-400",children:[e.jsx("li",{children:"• Larger diameter = stiffer bar (higher rate)"}),e.jsx("li",{children:"• Longer bar = softer bar (lower rate)"}),e.jsx("li",{children:"• Mark bars clearly for easy identification"}),e.jsx("li",{children:"• Inspect for cracks or damage regularly"}),e.jsx("li",{children:"• Keep matched pairs together by rate"}),e.jsx("li",{children:"• Clean and oil bars after each race"})]})]})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(r,{className:"w-16 h-16 mx-auto mb-4 text-gray-400"}),e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Sign in to manage torsion bars"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Calculate rates, track inventory, and optimize your setup"})]})}export{g as default};
